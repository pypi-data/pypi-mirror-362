

# Import coupling module
from gastli.atm_models_interp import atm_models_interp

# Other Python modules
import numpy as np
import matplotlib.pyplot as plt

# Test initialization
myatmmodel = atm_models_interp()

# OLD TESTS

Tint = 150.
g_surf = 1020.
Teq = 120.
CO = 0.55
log_FeH = 0
P_surf = 1e3

myatmmodel.calc_interior_mass_fraction(Tint,g_surf,Teq,CO=CO,log_FeH=log_FeH,P_surf=P_surf)
myatmmodel.calc_PTprofile(Tint,g_surf,Teq)


Tsurf_expected = 1941.0104835361076
MMF_surf_expected = 0.013495597373783932

Pprofile_expected = np.array([1.00000000e-05,1.15349444e-05,1.33054941e-05,1.53478134e-05
,1.77036174e-05,2.04210242e-05,2.35555378e-05,2.71711817e-05
,3.13418069e-05,3.61525999e-05,4.17018228e-05,4.81028206e-05
,5.54863359e-05,6.40031797e-05,7.38273116e-05,8.51593932e-05
,9.82308862e-05,1.13308781e-04,1.30701048e-04,1.50762932e-04
,1.73904203e-04,2.00597530e-04,2.31388135e-04,2.66904926e-04
,3.07873347e-04,3.55130193e-04,4.09640701e-04,4.72518269e-04
,5.45047194e-04,6.28708906e-04,7.25212225e-04,8.36528266e-04
,9.64930700e-04,1.11304219e-03,1.28388798e-03,1.48095764e-03
,1.70827639e-03,1.97048731e-03,2.27294615e-03,2.62183074e-03
,3.02426717e-03,3.48847535e-03,4.02393691e-03,4.64158883e-03
,5.35404689e-03,6.17586330e-03,7.12382395e-03,8.21729129e-03
,9.47859978e-03,1.09335121e-02,1.26117454e-02,1.45475781e-02
,1.67805504e-02,1.93562715e-02,2.23273515e-02,2.57544757e-02
,2.97076444e-02,3.42676025e-02,3.95274888e-02,4.55947384e-02
,5.25932771e-02,6.06660525e-02,6.99779540e-02,8.07191805e-02
,9.31091256e-02,1.07400858e-01,1.23886292e-01,1.42902149e-01
,1.64836834e-01,1.90138370e-01,2.19323552e-01,2.52988497e-01
,2.91820824e-01,3.36613696e-01,3.88282026e-01,4.47881156e-01
,5.16628422e-01,5.95928010e-01,6.87399643e-01,7.92911663e-01
,9.14619192e-01,1.05500815e+00,1.21694603e+00,1.40374047e+00
,1.61920682e+00,1.86774606e+00,2.15443469e+00,2.48512843e+00
,2.86658181e+00,3.30658617e+00,3.81412875e+00,4.39957629e+00
,5.07488677e+00,5.85385365e+00,6.75238761e+00,7.78884154e+00
,8.98438537e+00,1.03634385e+01,1.19541687e+01,1.37890671e+01
,1.59056121e+01,1.83470351e+01,2.11632029e+01,2.44116368e+01
,2.81586872e+01,3.24808890e+01,3.74665247e+01,4.32174278e+01
,4.98510624e+01,5.75029231e+01,6.63293019e+01,7.65104806e+01
,8.82544137e+01,1.01800975e+02,1.17426858e+02,1.35451228e+02
,1.56242237e+02,1.80224552e+02,2.07888017e+02,2.39797671e+02
,2.76605279e+02,3.19062651e+02,3.68036992e+02,4.24528623e+02
,4.89691404e+02,5.64856310e+02,6.51558610e+02,7.51569232e+02
,8.66930927e+02,1.00000000e+03])

Tprofile_expected = np.array([ 102.77023825,103.34919263,103.87759887,104.3733976, 104.82072766
,105.20035663,105.54124702,105.82127964,106.03087234,106.17867934
,106.24557454,106.24813199,106.18828106,106.06827442,105.890542
,105.67327786,105.40237416,105.07255361,104.67560685,104.19941728
,103.33934112,102.28195297,100.18208186, 98.14385523, 99.9966862
,102.14825158,103.94719125,105.295193,106.25343806,107.10654592
,106.8558605, 106.54039716,106.20735157,105.90221782,105.66565434
,105.48964364,105.35743813,105.26779142,105.23072354,105.27195233
,105.43918112,105.73037373,106.13234754,106.6411401, 107.26645435
,108.00889294,108.86431897,109.84569063,110.95603626,112.18433368
,113.45776793,114.79961454,116.20281916,117.66608011,119.19648601
,120.7381979, 122.3212745, 123.94391108,125.60786994,127.31995097
,129.04688704,130.95280041,133.28959043,135.97207746,138.43889446
,141.27570195,144.58812756,148.40368678,153.16581178,159.89036434
,166.9856005, 174.48277178,182.38770915,190.70460778,199.4358488
,208.31311964,217.62401157,227.38962498,237.63183491,248.37326635
,259.27946625,270.70643295,282.67921057,295.22477614,308.37239114
,321.71551478,335.69337517,350.3354386, 365.67210982,381.73467613
,398.04047774,415.14587167,433.092834,451.92505753,471.68786612
,491.77630196,512.84824871,534.95514522,558.15019858,582.4881575
,607.21888709,633.14694387,660.33007647,688.82810064,718.70281926
,749.01422145,780.754662,813.98599752,848.77108192,885.17342933
,922.021404,960.5286718,1000.75716998, 1042.76913016, 1086.62677316
, 1130.86672656, 1176.98127766, 1225.032977, 1275.08436553, 1327.19774635
, 1379.59043512, 1434.06980979, 1490.70174883, 1549.55271237, 1610.68974974
, 1671.96606043, 1735.52175318, 1801.47751932, 1869.94312868, 1941.01048354])

Rbulk = 0.967983603432466
Matm_earth = 0.03814827028578978
myatmmodel.calc_thickness(Rbulk,Matm_earth)

total_radius_expected = 0.9967767608285334
z_ode_expected = 0.02879315739606736

rho_ode_expected = np.array([7.94484781e-15,1.01541765e-14,1.26828041e-14,1.56031994e-14
,1.87866456e-14,2.19787617e-14,2.52884669e-14,2.83640659e-14
,3.09000937e-14,3.28192082e-14,3.37252418e-14,3.37603484e-14
,3.29477728e-14,3.13751760e-14,2.91789307e-14,2.66959852e-14
,2.38856297e-14,2.08495056e-14,1.76892261e-14,1.45074764e-14
,1.01092276e-14,6.44877630e-15,2.59310631e-15,1.04577985e-15
,2.38986376e-15,6.08976722e-15,1.30546454e-14,2.28548115e-14
,3.38333382e-14,4.77838671e-14,4.31908167e-14,3.80154763e-14
,3.32046068e-14,2.93185372e-14,2.66127042e-14,2.47581098e-14
,2.34480996e-14,2.25982863e-14,2.22556797e-14,2.26370405e-14
,2.42499259e-14,2.73279353e-14,3.22055553e-14,3.95991554e-14
,5.09569650e-14,6.85665903e-14,9.61922599e-14,1.41209241e-13
,2.16779399e-13,3.45883007e-13,5.57192726e-13,9.13371786e-13
,1.51799771e-12,2.55414112e-12,4.35723043e-12,7.38687449e-12
,1.25700311e-11,2.14446422e-11,3.66794108e-11,6.30011288e-11
,1.07488653e-10,1.91335087e-10,3.81072596e-10,8.20702032e-10
,1.62627419e-09,3.48373666e-09,8.21195658e-09,2.11679250e-08
,6.51252741e-08,2.87474589e-07,1.22188127e-06,4.99587545e-06
,1.95291429e-05,7.25802998e-05,2.55024812e-04,8.13876431e-04
,2.43324493e-03,6.68352572e-03,1.62838247e-02,3.36284931e-02
,5.66452395e-02,8.11573732e-02,1.03655601e-01,1.23647591e-01
,1.42153262e-01,1.60454046e-01,1.79408393e-01,1.99570670e-01
,2.21362763e-01,2.45115085e-01,2.71489095e-01,3.00470538e-01
,3.32801650e-01,3.67208661e-01,4.05718481e-01,4.48752923e-01
,4.96207115e-01,5.48525406e-01,6.06194499e-01,6.69771862e-01
,7.40827112e-01,8.19186925e-01,9.05497216e-01,1.00066051e+00
,1.10555780e+00,1.22279503e+00,1.35211452e+00,1.49476185e+00
,1.65208424e+00,1.82551855e+00,2.01929395e+00,2.23310630e+00
,2.46912839e+00,2.72922504e+00,3.01622938e+00,3.33730934e+00
,3.69158787e+00,4.08270993e+00,4.51420890e+00,4.98999745e+00
,5.52225131e+00,6.10946583e+00,6.75659591e+00,7.47089424e+00
,8.25842229e+00,9.13685854e+00,1.01051526e+01,1.11716318e+01
,1.23439121e+01,1.36347690e+01])


def test_answer():
    assert myatmmodel.Tsurf == Tsurf_expected
    assert myatmmodel.MMF_surf == MMF_surf_expected
    assert len(myatmmodel.Pprofile) == len(Pprofile_expected)
    assert all([a-b<1e-6 for a, b in zip(myatmmodel.Pprofile, Pprofile_expected)])
    assert len(myatmmodel.Tprofile) == len(Tprofile_expected)
    assert all([a-b<1e-6 for a, b in zip(myatmmodel.Tprofile, Tprofile_expected)])
    assert myatmmodel.total_radius == total_radius_expected
    assert myatmmodel.z_ode == z_ode_expected
    assert len(myatmmodel.rho_ode) == len(rho_ode_expected)
    assert all([a-b<1e-6 for a, b in zip(myatmmodel.rho_ode, rho_ode_expected)])


