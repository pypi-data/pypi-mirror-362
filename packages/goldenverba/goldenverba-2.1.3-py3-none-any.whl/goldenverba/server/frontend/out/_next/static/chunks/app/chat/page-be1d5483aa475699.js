(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{86915:function(e,t,n){Promise.resolve().then(n.bind(n,70321))},70321:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var s=n(57437),o=n(2265),a=n(13921),r=n(44025),l=n(38666),c=n(15560),i=n.n(c),d=n(14063),m=n(45614);function p(e){let{onUserMessageSubmit:t,isFetching:n,setHandleGenerateStreamMessageRef:c,apiHost:p,setIsFetching:u}=e,[h,x]=(0,o.useState)([]),g=(0,o.useRef)(null),[f,y]=(0,o.useState)(null),b=(0,o.useRef)(null),[j,v]=(0,o.useState)(""),[w,N]=(0,o.useState)(!1),S=()=>{let e="https:"===window.location.protocol?"wss:":"ws:",t=window.location.host;return"".concat(e,"//").concat(t,"/ws/generate_stream")},k=e=>{navigator.clipboard.writeText(e).then(function(){console.log("Text successfully copied to clipboard!"),N(!0),setTimeout(()=>{N(!1)},3e3)},function(e){console.error("Unable to copy text: ",e)})};(0,o.useEffect)(()=>{c(b)},[c]),(0,o.useEffect)(()=>{let e=new WebSocket(S());return e.onopen=()=>{console.log("WebSocket connection opened.")},e.onmessage=e=>{let t;try{t=JSON.parse(e.data)}catch(t){console.error("Received data is not valid JSON:",e.data);return}let n=t.message;if(v(e=>e+n),"stop"===t.finish_reason){u(!1);let e=t.full_text;if(t.cached){let n=t.distance;x(t=>[...t,{type:"system",content:e,typewriter:!1,cached:!0,distance:n}])}else x(t=>[...t,{type:"system",content:e,typewriter:!1}]);v("")}},e.onerror=e=>{console.error("WebSocket Error:",e)},e.onclose=e=>{e.wasClean?console.log("WebSocket connection closed cleanly, code=".concat(e.code,", reason=").concat(e.reason)):console.error("WebSocket connection died")},y(e),()=>{e.readyState!==WebSocket.CLOSED&&e.close()}},[]),b.current=(e,t)=>{if((null==f?void 0:f.readyState)===WebSocket.OPEN){console.log(h);let n=JSON.stringify({query:e,context:t,conversation:h});f.send(n)}else console.error("WebSocket is not open. ReadyState:",null==f?void 0:f.readyState)};let O=e=>{let t=[],n=0;return e.replace(/```(.*?)\n([\s\S]*?)```/g,(s,o,a,r)=>(r>n&&t.push({type:"text",content:e.slice(n,r)}),t.push({type:"code",language:o.trim(),content:a.trim()}),n=r+s.length,s)),n<e.length&&t.push({type:"text",content:e.slice(n)}),t};return(0,o.useEffect)(()=>{if(t.length&&(0===h.length||t[t.length-1].content!==h[h.length-1].content)){let e=t[t.length-1];x(t=>[...t,e])}},[t]),(0,o.useEffect)(()=>{if(g.current){let e=h[h.length-1];"system"===e.type?setTimeout(()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},25*e.content.length):g.current.scrollIntoView({behavior:"smooth"})}},[h]),(0,s.jsxs)("div",{className:"bg-gray-100 p-4 overflow-y-auto h-[35vh]",children:[h.map((e,t)=>(0,s.jsxs)("div",{ref:t===h.length-1?g:null,className:"mb-4 ".concat("user"===e.type?"text-right":""),children:[(0,s.jsxs)("div",{className:"flex",children:["system"===e.type&&(0,s.jsxs)("button",{onClick:()=>k(e.content),className:"rounded-md flex py-2 px-3 bg-gray-200 text-black hover-container mb-1 hover:bg-green-300",children:[(0,s.jsx)(d.esY,{size:15}),(0,s.jsx)("span",{className:"text-xs ml-2",children:"Copy"})]}),"system"===e.type&&e.cached&&(0,s.jsxs)("button",{className:"rounded-md flex ml-2 py-2 px-3 bg-gray-200 text-black hover-container mb-1 hover:bg-green-300",children:[(0,s.jsx)(m.JTb,{size:15}),(0,s.jsxs)("span",{className:"text-xs ml-2",children:["Cached (",e.distance,")"]})]})]}),(0,s.jsx)("span",{className:"inline-block p-3 rounded-xl animate-press-in shadow-md font-mono text-sm ".concat("user"===e.type?"bg-yellow-200":"bg-white"),children:"system"===e.type?O(e.content).map((e,t)=>"text"===e.type?(0,s.jsx)("div",{className:"my-markdown-styles",children:(0,s.jsx)(a.D,{children:e.content})},t):"code"===e.type?(0,s.jsx)(r.Z,{language:e.language,style:l.Yn,className:"rounded p-2",children:e.content},t):null):e.content})]},t)),j&&(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("span",{className:"inline-block p-3 rounded-xl animate-press-in shadow-md font-mono text-sm bg-white",children:O(j).map((e,t)=>"text"===e.type?(0,s.jsx)("p",{children:e.content},t):"code"===e.type?(0,s.jsx)(r.Z,{language:e.language,style:l.Yn,className:"rounded p-2",children:e.content},t):null)})}),n&&(0,s.jsx)("div",{className:"flex items-center pl-4 mb-4",children:(0,s.jsx)(i(),{color:"#292929",loading:!0,size:10,speedMultiplier:.75})}),w&&(0,s.jsx)("div",{className:"fixed bottom-5 left-5 animate-pop-in bg-green-500 text-white px-4 py-2 rounded text-sm shadow-md mt-4 mr-4 transition-opacity opacity-100",children:"Text copied!"})]})}var u=n(47825),h=n(88046),x=n(6089),g=n(77095);function f(){let[e,t]=(0,o.useState)(!1),[n,a]=(0,o.useState)([]),[r,l]=(0,o.useState)(""),[c,i]=(0,o.useState)(!1),[m,f]=(0,o.useState)(""),[y,b]=(0,o.useState)(""),[j,v]=(0,o.useState)("#"),[w,N]=(0,o.useState)([]),[S,k]=(0,o.useState)("Offline"),[O,C]=(0,o.useState)(null),[_,T]=(0,o.useState)([]),[E,P]=(0,o.useState)(!1),[D,W]=(0,o.useState)(!1),[R,G]=(0,o.useState)(!1),I=(0,o.useRef)(null),J="TO-DO",F=(0,o.useCallback)(async()=>{try{let e=await fetch(J+"/api/health");200===e.status?k("Online"):k("Offline")}catch(e){k("Offline")}},[]);(0,o.useEffect)(()=>{(async()=>{try{let e=await fetch(J+"/api/get_production",{method:"GET",headers:{"Content-Type":"application/json"}}),t=await e.json();!0==t.production?console.log("In Production Mode"):console.log("In Normal Mode"),P(t.production)}catch(e){console.error("Failed to fetch document:",e)}})()},[]),(0,o.useEffect)(()=>{F()},[F]);let H=async(e,t)=>{try{console.log(_);let n=await fetch(J+"/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,context:t,conversation:_})}),s=await n.json();s.system&&T(e=>[...e,{type:"system",content:s.system,typewriter:!0}])}catch(e){console.error("Failed to fetch from API:",e)}finally{W(!1)}},Z=(e,t)=>{I.current&&I.current(e,t)},M=e=>{i(e)},V=async(e,t)=>{null==e||e.preventDefault();let n=t||r;if(n.trim()){T(e=>[...e,{type:"user",content:n,typewriter:!0}]),a([]),l(""),W(!0);try{F();let e=await fetch(J+"/api/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:n})}),t=await e.json();F(),N([]),N(t.documents),a([]),""!=t.context?c?Z(n,t.context):H(n,t.context):(W(!1),T(e=>[...e,{type:"system",content:"Your Verba has no data yet :(",typewriter:!0}]))}catch(e){F(),console.error("Failed to fetch from API:",e)}}};(0,o.useEffect)(()=>{w&&w.length>0&&C(w[0])},[w]),(0,o.useEffect)(()=>{(async()=>{if(O&&O.doc_uuid)try{let e=await fetch(J+"/api/get_document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({document_id:O.doc_uuid})}),t=await e.json();f(t.document.properties.doc_name),b(t.document.properties.text),v(t.document.properties.doc_link)}catch(e){console.error("Failed to fetch document:",e)}})()},[O]);let A=e=>new Promise(t=>setTimeout(t,e)),L=async e=>{try{G(!0);let t=await fetch(J+"/api/suggestions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})}),n=await t.json();""!=r&&a(n.suggestions),await A(1e3),G(!1)}catch(e){console.error("Failed to fetch suggestions:",e),G(!1)}},q=async e=>{l(e),V(void 0,e)},z=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Y=(e,t)=>{let n=z(t),o=e.split(RegExp("(".concat(n,")"),"gi"));return(0,s.jsx)("span",{children:o.map((e,n)=>(0,s.jsx)("span",{className:e.toLowerCase()===t.toLowerCase()?"font-bold text-sm":"",children:e},n))})};return(0,s.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-between p-10 text-gray-900",children:[e&&(0,s.jsx)(h.Z,{onClose:()=>{t(!1)},apiHost:J}),(0,s.jsxs)("div",{className:"flex flex-col w-full items-start",children:[(0,s.jsx)("div",{className:"mb-2",children:(0,s.jsxs)("div",{className:"flex justify-between items-center w-full",children:[" ",(0,s.jsx)("div",{className:"flex-none",children:(0,s.jsx)("div",{className:"bg-yellow-200 border-2 border-gray-800 rounded-lg shadow-lg animate-pop-in hover-container mr-4 ",children:(0,s.jsx)("img",{src:"".concat("TO-DO","verba.png"),alt:"Verba Logo",className:" w-24 h-24 shadow-lg"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h1",{className:" text-6xl font-bold",children:"Verba"}),(0,s.jsxs)("div",{className:"flex text-lg",children:[(0,s.jsx)("span",{className:"bg-opacity-0 rounded px-2 py-1 hover-container animate-pop-in",children:"The"}),(0,s.jsx)("span",{className:"bg-opacity-0 rounded font-bold px-2 py-1 hover-container animate-pop-in-late",children:"Golden"}),(0,s.jsx)("span",{className:"bg-yellow-200 rounded px-2 py-1 hover-container animate-pop-more-late",children:"RAGtriever"})]})]}),(0,s.jsxs)("div",{className:"lg:flex sm:grid sm:grid-cols-2 sm:gap-y-2 md:grid md:grid-cols-2 md:gap-x-4 md:gap-y-4 justify-between items-center mx-auto p-4 ml-10",children:[(0,s.jsx)("div",{className:"ml-5 animate-pop-in",children:(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("button",{className:"flex items-center sm:w-32 md:w-44 space-x-2 mr-8 bg-gray-200 text-black p-3  rounded-lg  hover:bg-green-400 border-2 border-black hover:border-white hover-container shadow-md",onClick:()=>t(!0),children:[(0,s.jsx)(d.wEH,{}),(0,s.jsx)("span",{className:"truncate",children:"Add Documents"})]})})}),(0,s.jsx)(x.Z,{component:"embedders",apiHost:J,onGeneratorSelect:M,production:E}),(0,s.jsx)(x.Z,{component:"retrievers",apiHost:J,onGeneratorSelect:M,production:E}),(0,s.jsx)(x.Z,{component:"generators",apiHost:J,onGeneratorSelect:M,production:E})]})]})}),(0,s.jsx)("div",{className:"lg:flex md:flex ".concat(w.length<=8?"full:justify-center":""," justify-items-start overflow-x-auto h-36 w-full mb-2 hidden"),children:w.map((e,t)=>(0,s.jsx)("button",{onClick:()=>C(e),children:(0,s.jsxs)("div",{className:"bg-none\n                  } rounded-lg text-xs hover-container mx-1 h-28 w-48 p-1 animate-pop-in",children:[(0,s.jsx)("div",{className:"text-xs mb-1 ".concat(O===e?"":"fade-in-out"," bg-yellow-300 p-2 rounded-lg w-full"),children:e.doc_type}),(0,s.jsx)("div",{className:"flex space-x-2 mt-1",children:(0,s.jsxs)("div",{className:"flex items-center rounded-md bg-gray-200 p-2 truncate h-16 border-2 shadow-md hover:border-white border-black ".concat(O===e?"bg-green-300":"bg-gray-300"),children:[(0,s.jsxs)("div",{className:"text-sm font-bold bg-green-300 p-2 rounded-lg",children:[" ",(0,s.jsx)(g.ZP,{end:Math.round(100*e.score)})]}),(0,s.jsx)("p",{className:"font-bold ml-1",children:e.doc_name})]})})]})},e.doc_name+t))}),(0,s.jsxs)("div",{className:"flex w-full space-x-4 overflow-y-auto mb-20",children:[(0,s.jsxs)("div",{className:"lg:w-1/2 md:w-full sm:w-full p-2 border-2 shadow-lg border-gray-900 rounded-xl animate-pop-in",children:[(0,s.jsxs)("div",{className:"rounded-t-xl bg-gray-200 p-4 flex justify-between items-center",children:["\uD83D\uDC15 RAGtriever Chat",(0,s.jsxs)("div",{className:"text-xs text-white font-mono flex justify-center",children:[(0,s.jsx)("a",{href:"https://github.com/weaviate/Verba",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("span",{className:"rounded-indicator hover-container text-white p-2 ".concat("Online"===S?"bg-green-500 hover:bg-green-400":"bg-red-500 hover:bg-red-400"),children:S+" v0.4.0"})}),(0,s.jsx)("a",{href:"https://www.weaviate.io",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("span",{className:"rounded-indicator text-white bg-gray-400 hover:bg-gray-300 ml-2 p-2 hover-container",children:"Powered by Weaviate ❤️"})})]})]}),(0,s.jsx)(p,{onUserMessageSubmit:_,isFetching:D,apiHost:"TODO",setHandleGenerateStreamMessageRef:e=>{I.current=e.current},setIsFetching:W}),(0,s.jsx)("form",{className:"rounded-b-xl bg-gray-500 p-4 relative",onSubmit:V,children:(0,s.jsx)("input",{type:"text",value:r,onChange:e=>{l(e.target.value),R||L(e.target.value)},disabled:D,placeholder:"What is a vector database?",className:"w-full p-2 rounded-md bg-bg-alt-verba text-gray-900 placeholder-gray-400"})}),(0,s.jsx)("div",{className:"absolute mt-2 p-2 z-10 w-1/2 left-5 text-center justify-center flex flex-wrap",children:n.map((e,t)=>(0,s.jsx)("div",{className:"p-2 hover:bg-green-300 bg-gray-200 cursor-pointer shadow-md rounded-md text-xs animate-press-in mt-2 mr-4 hover-container",onClick:()=>q(e),children:Y(e,r)},t+e))})]}),(0,s.jsx)("div",{className:"w-1/2 space-y-4 hidden lg:block md:block",children:(0,s.jsx)(u.I,{title:m,text:y,extract:null==O?void 0:O.text,docLink:j,type:null==O?void 0:O.doc_type})})]})]})]})}}},function(e){e.O(0,[420,582,33,652,465,447,183,720,369,634,971,23,744],function(){return e(e.s=86915)}),_N_E=e.O()}]);