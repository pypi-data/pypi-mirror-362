{"version":3,"file":"lib_index_js.a8ad77ecf9ebf82de087.js","mappings":"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","sources":["webpack://jupyterlab-firefox-launcher/./frontend/src/index.ts"],"sourcesContent":["// src/index.ts\nimport type { JupyterFrontEnd, JupyterFrontEndPlugin } from '@jupyterlab/application';\nimport { ILauncher } from '@jupyterlab/launcher';\nimport { ICommandPalette, MainAreaWidget } from '@jupyterlab/apputils';\nimport { Widget } from '@lumino/widgets';\nimport { ServerConnection } from '@jupyterlab/services';\n\n// Firefox SVG icon\nconst firefoxIconSvg = `\n<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n  <path d=\"M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z\" fill=\"#FF7139\"/>\n  <path d=\"M19.5 9.5c-1.2-1.8-3.2-3-5.5-3-1.2 0-2.3.3-3.3.8.5-.4 1.1-.8 1.8-.8 2.2 0 4 1.8 4 4 0 .7-.2 1.4-.5 2h3.5zm-7.5 6c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4z\" fill=\"#FF4F00\"/>\n  <circle cx=\"12\" cy=\"11.5\" r=\"2.5\" fill=\"#FFA500\"/>\n</svg>\n`;\n\n// Inject CSS styles\nconst addFirefoxStyles = () => {\n  const styleId = 'firefox-launcher-styles';\n  if (document.getElementById(styleId)) {\n    return; // Already added\n  }\n  \n  const style = document.createElement('style');\n  style.id = styleId;\n  style.textContent = `\n    /* Firefox icon styling for JupyterLab */\n    .jp-firefox-icon {\n      background-image: url('data:image/svg+xml;base64,${btoa(firefoxIconSvg)}');\n      background-repeat: no-repeat;\n      background-size: 16px;\n      background-position: center;\n      width: 16px;\n      height: 16px;\n      display: inline-block;\n    }\n    \n    .jp-firefox-icon::before {\n      content: '';\n      display: inline-block;\n      width: 16px;\n      height: 16px;\n      background-image: inherit;\n      background-repeat: inherit;\n      background-size: inherit;\n      background-position: inherit;\n    }\n    \n    .jp-LauncherCard[data-command=\"firefox:open\"] .jp-LauncherCard-icon {\n      background-image: url('data:image/svg+xml;base64,${btoa(firefoxIconSvg)}');\n      background-size: 32px;\n      background-repeat: no-repeat;\n      background-position: center;\n    }\n  `;\n  document.head.appendChild(style);\n};\n\nconst buildFirefoxHTML = (iframeId: string, sessionId: string, baseUrl: string): string => {\n  return `\n    <div style=\"display:flex; justify-content:space-between; align-items:center; padding:4px; gap:8px; background:#f5f5f5;\">\n      <span style=\"font-size:12px; color:#666;\">Session: ${sessionId}</span>\n      <div style=\"display:flex; gap:8px;\">\n        <button id=\"ff-refresh\">üîÑ Refresh</button>\n        <button id=\"ff-close\">‚ùå Close</button>\n      </div>\n    </div>\n    <div id=\"ff-status\" style=\"display:none; padding:20px; text-align:center; background:#f0f0f0;\">\n      Starting Firefox session...\n    </div>\n    <iframe \n      id=\"${iframeId}\"\n      src=\"${baseUrl}proxy/firefox/${sessionId}/\" \n      style=\"width:100%; height:90%; border:none; display:none;\"\n      allowfullscreen\n    ></iframe>`;\n};\n\n// Helper function to get CSRF token\nconst getCSRFToken = () => {\n  const tokenElement = document.querySelector('meta[name=\"_xsrf\"]');\n  return tokenElement ? tokenElement.getAttribute('content') : '';\n};\n\nconst extension: JupyterFrontEndPlugin<void> = {\n  id: 'jupyterlab-firefox-launcher:plugin',\n  description: 'JupyterLab extension to launch Firefox in a tab',\n  autoStart: true,\n  requires: [ILauncher, ICommandPalette],\n  activate: async (app: JupyterFrontEnd, launcher: ILauncher, palette: ICommandPalette): Promise<void> => {\n    // Add Firefox styles to the document\n    addFirefoxStyles();\n    \n    const command = 'firefox:open';\n    const label = 'Firefox Browser';\n\n    app.commands.addCommand(command, {\n      label,\n      execute: async () => {\n        const baseUrl = app.serviceManager.serverSettings.baseUrl;\n        const normalizedBaseUrl = baseUrl.endsWith('/') ? baseUrl : baseUrl + '/';\n        \n        console.log('Starting Firefox session...'); // Debug logging\n        \n        const content = new Widget();\n        content.node.style.height = '100%';\n        content.node.style.width = '100%';\n        content.node.style.overflow = 'hidden';\n\n        const widget = new MainAreaWidget({ content });\n        widget.id = 'firefox-browser-' + Date.now(); // Unique ID for each session\n        widget.title.label = label;\n        widget.title.closable = true;\n        // Add Firefox icon to the tab\n        widget.title.iconClass = 'jp-firefox-icon';\n        widget.node.style.height = '100%';\n\n        // Show the widget first with a loading state\n        const iframeId = 'firefox-iframe-' + Date.now();\n        content.node.innerHTML = `\n          <div style=\"display:flex; justify-content:center; align-items:center; height:100%; background:#f0f0f0;\">\n            <div style=\"text-align:center;\">\n              <div style=\"font-size:18px; margin-bottom:10px;\">ü¶ä</div>\n              <div>Starting Firefox session...</div>\n            </div>\n          </div>\n        `;\n\n        app.shell.add(widget, 'main');\n        app.shell.activateById(widget.id);\n\n        try {\n          // Use JupyterLab's ServerConnection for authenticated requests\n          const serverSettings = app.serviceManager.serverSettings;\n          \n          // Create a new Firefox session using JupyterLab's request mechanism\n          const response = await ServerConnection.makeRequest(\n            `${normalizedBaseUrl}firefox/session`,\n            {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n            },\n            serverSettings\n          );\n\n          if (!response.ok) {\n            throw new Error(`Failed to create session: ${response.statusText}`);\n          }\n\n          const sessionData = await response.json();\n          const sessionId = sessionData.session_id;\n          \n          console.log('Firefox session created:', sessionId);\n\n          // Update the content with the actual Firefox interface\n          content.node.innerHTML = buildFirefoxHTML(iframeId, sessionId, normalizedBaseUrl);\n\n          // Show status while Firefox starts up\n          const statusDiv = content.node.querySelector('#ff-status') as HTMLElement;\n          const iframe = content.node.querySelector(`#${iframeId}`) as HTMLIFrameElement;\n          \n          if (statusDiv && iframe) {\n            statusDiv.style.display = 'block';\n            \n            // Wait a bit for Xpra to fully start, then show iframe\n            setTimeout(() => {\n              statusDiv.style.display = 'none';\n              iframe.style.display = 'block';\n            }, 3000);\n          }\n\n          // Set up event handlers\n          const refreshBtn = content.node.querySelector('#ff-refresh');\n          const closeBtn = content.node.querySelector('#ff-close');\n\n          refreshBtn?.addEventListener('click', () => {\n            if (iframe) {\n              iframe.src = iframe.src;\n            }\n          });\n\n          closeBtn?.addEventListener('click', () => {\n            widget.close();\n          });\n\n          // Clean up session when widget is disposed\n          widget.disposed.connect(async () => {\n            try {\n              await ServerConnection.makeRequest(\n                `${normalizedBaseUrl}firefox/session/${sessionId}`,\n                {\n                  method: 'DELETE',\n                },\n                serverSettings\n              );\n              console.log('Firefox session cleaned up:', sessionId);\n            } catch (error) {\n              console.error('Error cleaning up session:', error);\n            }\n          });\n\n        } catch (error) {\n          console.error('Error starting Firefox session:', error);\n          const errorMessage = error instanceof Error ? error.message : String(error);\n          content.node.innerHTML = `\n            <div style=\"display:flex; justify-content:center; align-items:center; height:100%; background:#ffe6e6; color:#d00;\">\n              <div style=\"text-align:center;\">\n                <div style=\"font-size:18px; margin-bottom:10px;\">‚ùå</div>\n                <div>Failed to start Firefox session</div>\n                <div style=\"font-size:12px; margin-top:10px;\">${errorMessage}</div>\n              </div>\n            </div>\n          `;\n        }\n      }\n    });\n\n    launcher.add({\n      command,\n      category: 'Other',\n      rank: 1,\n      // Add Firefox icon to launcher\n      kernelIconUrl: `data:image/svg+xml;base64,${btoa(firefoxIconSvg)}`\n    });\n\n    palette.addItem({\n      command,\n      category: 'Other'\n    });\n  }\n};\n\nexport default extension;\n\nexport { buildFirefoxHTML };"],"names":[],"sourceRoot":""}