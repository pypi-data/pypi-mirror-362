<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <record id="helpdesk_ticket_activity_page_view" model="ir.ui.view">
      <field name="name">helpdesk.ticket.activity.page.view</field>
      <field name="model">helpdesk.ticket</field>
      <field name="inherit_id" ref="helpdesk_ticket_mail_message.helpdesk_ticket_mail_message_form_view"/>
      <field name="arch" type="xml">
          <xpath expr="//page[@name='communications']" position="after">
              <page string="Activities" name="activities">
                <button name="action_new_activity" string="Create activity" type="object"/>
                <!--Create auxiliar variable to avoid widget collision with activity_ids-->
                <field name="ticket_activity_ids"
                       widget="one2many"
                       context="{
                          'tree_view_ref':'helpdesk_ticket_activity_ids.view_mail_activity_tree_helpdesk_ticket_page',
                          'limit_fields': ['note'],
                          'date_fields_from_now': ['date_deadline'],
                        }"/>
              </page>
          </xpath>
      </field>
  </record>
  <record id="helpdesk_ticket_activity_tree_view" model="ir.ui.view">
      <field name="name">helpdesk.ticket.activity.tree.view</field>
      <field name="model">helpdesk.ticket</field>
      <field name="inherit_id" ref="helpdesk_mgmt.ticket_view_tree"/>
      <field name="arch" type="xml">
          <field name="last_stage_update" position="after">
              <field name="activity_state" invisible="1"/>
              <field name="activity_ids" widget="kanban_activity"/>
          </field>
      </field>
  </record>
</odoo>
