"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9392],{2588:function(e,n,o){o.d(n,{Z:function(){return s}});var t=o(57437),r=o(11164),l=o(14759),a=o(18133),i=o(79239);function s(e){let{soundEvent:n,...o}=e,s=(0,l.Z)(e=>e.getTagColor),{data:c,addTag:u,removeTag:d}=(0,r.Z)({uuid:n.uuid,soundEventAnnotation:n,onAddTag:o.onAddTag,onRemoveTag:o.onRemoveTag});return(0,t.jsx)(a.lR,{soundEvent:c||n,...o,tagColorFn:s,onAddTag:u.mutate,onRemoveTag:d.mutate,TagSearchBar:i.Z})}},79239:function(e,n,o){o.d(n,{Z:function(){return s}});var t=o(57437),r=o(2265),l=o(2185),a=o(65198),i=o(34657);function s(e){let{onCreateTag:n,...o}=e,s=(0,r.useContext)(a.Z),{data:c,addTag:u}=(0,l.Z)({uuid:s.uuid,annotationProject:s}),d=(0,r.useMemo)(()=>({annotation_project:c||s}),[c,s]),f=(0,r.useCallback)(e=>{u.mutate(e),null==n||n(e)},[u,n]);return(0,t.jsx)(i.Z,{onCreateTag:f,filter:d,fixed:["annotation_project"],...o})}},65198:function(e,n,o){let t=(0,o(2265).createContext)({name:"",description:"",tags:[],created_on:new Date,uuid:""});n.Z=t},2185:function(e,n,o){o.d(n,{Z:function(){return d}});var t=o(57437),r=o(21770),l=o(2265),a=o(69064),i=o(23857),s=o(80207);function c(e){var n;let{error:o,message:r}=e,i=null===(n=o.response)||void 0===n?void 0:n.data,c=null==i?void 0:i.exception,u=null==i?void 0:i.traceback,d=c&&u,f=d?"Please copy the error below and report the issue to the developers (see guide on reporting errors).":"Oops, an unexpected error occurred. Please try running whombat on debug mode (consult guide) and try again to see the full error message.",h="\nUser Message: ".concat(r,"\n\n").concat(f,"\n\n").concat(d?"Exception:\n".concat(c,"\n\nTraceback:\n").concat(u,"\n\n"):"","Full Error Details (for debugging):\n").concat(JSON.stringify(o.response,null,2),"\n  ").trim(),v=(0,l.useCallback)(()=>a.ZP.promise(navigator.clipboard.writeText(h),{loading:"Copying...",success:"Copied to clipboard",error:"Failed to copy"}),[h]);return(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("p",{className:"font-bold text-red-500",children:r}),(0,t.jsx)("p",{className:"mt-2 text-sm",children:f}),(0,t.jsx)("div",{className:"flex flex-row gap-2 items-center",children:(0,t.jsx)(s.Z,{mode:"text",onClick:v,children:"Copy Error Details"})}),d&&(0,t.jsxs)("details",{className:"p-2 text-xs rounded",children:[(0,t.jsx)("summary",{className:"cursor-pointer",children:"Show Error Information"}),(0,t.jsxs)("pre",{className:"overflow-y-auto mt-4 max-h-48 whitespace-pre-wrap break-all text-stone-500",children:[(0,t.jsx)("strong",{children:"Exception:"}),(0,t.jsx)("br",{}),c,(0,t.jsx)("br",{}),(0,t.jsx)("br",{}),(0,t.jsx)("strong",{children:"Traceback:"}),(0,t.jsx)("br",{}),u]})]})]})}var u=o(58435);function d(e){let{uuid:n,annotationProject:o,onUpdate:s,onDelete:d,onAddTag:f,onRemoveTag:h,onAddAnnotationTasks:v,onError:g,enabled:p=!0}=e,{query:m,useMutation:x,client:b}=(0,u.ZP)({id:n,initialData:o,name:"annotation_project",enabled:p,queryFn:i.Z.annotationProjects.get,onError:g}),y=x({mutationFn:i.Z.annotationProjects.update,onSuccess:e=>{a.ZP.success("Annotation project updated"),null==s||s(e)}}),j=x({mutationFn:i.Z.annotationProjects.addTag,onSuccess:f}),Z=x({mutationFn:i.Z.annotationProjects.removeTag,onSuccess:h}),k=x({mutationFn:i.Z.annotationProjects.delete,onSuccess:d}),{data:w}=m,C=(0,l.useCallback)(async e=>{if(null==w)return;let n=await i.Z.clips.createMany(e);return await i.Z.annotationTasks.createMany(w,n)},[w]),T=(0,r.D)({mutationFn:C,onSuccess:e=>{null!=e&&(null==v||v(e),b.invalidateQueries({queryKey:["annotation_project",n]}))}}),E=(0,l.useCallback)(async()=>{await a.ZP.promise(i.Z.annotationProjects.download(n),{loading:"Downloading...",success:"Download complete",error:e=>(0,t.jsx)(c,{error:e,message:"Failed to download dataset"})})},[n]);return{...m,update:y,addTag:j,addAnnotationTasks:T,removeTag:Z,delete:k,download:E}}},11164:function(e,n,o){o.d(n,{Z:function(){return i}});var t=o(21770),r=o(2265),l=o(23857),a=o(58435);function i(e){let{uuid:n,soundEventAnnotation:o,clipAnnotation:i,onDelete:s,onUpdate:c,onAddTag:u,onRemoveTag:d,onAddNote:f,onError:h,enabled:v=!0,withRecording:g=!1}=e,{query:p,useQuery:m,useMutation:x,useDestruction:b,client:y}=(0,a.ZP)({name:"sound_event_annotation",id:n,initialData:o,enabled:v,queryFn:l.Z.soundEventAnnotations.get,onError:h}),j=m({secondaryName:"recording",queryFn:(0,r.useMemo)(()=>g?()=>{if(null==p.data)throw Error("Cannot get recording for sound event annotation without recording");return l.Z.soundEvents.getRecording(p.data.sound_event)}:()=>{throw Error("Cannot get recording for sound event annotation without recording")},[p.data,g]),enabled:g&&null!=p.data}),Z=(0,r.useCallback)(e=>{null!=i&&y.setQueryData(["clip_annotation",i.uuid],n=>{var o;if(null!=n)return{...n,sound_events:null===(o=n.sound_events)||void 0===o?void 0:o.map(n=>n.uuid===e.uuid?e:n)}})},[y,i]),k=(0,r.useCallback)(e=>{null==c||c(e),Z(e)},[c,Z]),w=x({mutationFn:l.Z.soundEventAnnotations.update,onSuccess:k}),C=(0,r.useCallback)(e=>{null==s||s(e),Z(e)},[s,Z]),T=b({mutationFn:l.Z.soundEventAnnotations.delete,onSuccess:C}),E=(0,r.useCallback)((e,n)=>{null==u||u(n),Z(e)},[u,Z]),P=x({mutationFn:l.Z.soundEventAnnotations.addTag,onSuccess:E}),A=(0,r.useCallback)((e,n)=>{null==d||d(n),Z(e)},[d,Z]),N=x({mutationFn:l.Z.soundEventAnnotations.removeTag,onSuccess:A}),F=(0,r.useCallback)((e,n)=>{null==f||f(n),Z(e)},[f,Z]),S=x({mutationFn:l.Z.soundEventAnnotations.addNote,onSuccess:F}),_=(0,t.D)({mutationFn:e=>{let{note:n,data:o}=e;return l.Z.notes.update(n,o)},onSuccess:()=>{p.refetch()}}),D=x({mutationFn:l.Z.soundEventAnnotations.removeNote});return{...p,update:w,delete:T,addTag:P,removeTag:N,addNote:S,updateNote:_,removeNote:D,recording:j}}},57887:function(e,n,o){var t=o(57437),r=o(2265),l=o(27432);let a=(0,r.memo)(function(e){return(0,t.jsxs)(l.Z,{className:"w-full",children:[(0,t.jsxs)("div",{className:"flex flex-row gap-4",children:[e.ViewportToolbar,e.AnnotationControls,e.Player,e.SettingsMenu]}),e.Canvas,e.ViewportBar,e.SelectedSoundEvent]})});n.Z=a},18133:function(e,n,o){o.d(n,{ZP:function(){return f},lR:function(){return h}});var t=o(57437),r=o(36760),l=o.n(r),a=o(2265),i=o(31476),s=o(44317),c=o(43289),u=o(65781),d=o(54259);function f(e){let{children:n,soundEvents:o,viewport:r,SoundEventTags:l=h,...i}=e,{size:u,ref:d}=(0,s.Z)(),f=(0,a.useMemo)(()=>o.filter(e=>(0,c.PT)(e.sound_event.geometry,r)),[o,r]);return(0,t.jsxs)("div",{className:"relative w-full h-full rounded",ref:d,children:[n,f.map(e=>(0,t.jsx)(l,{viewport:r,soundEvent:e,dimensions:u,...i},e.uuid))]})}function h(e){var n;let{soundEvent:o,viewport:r,dimensions:a,enabled:i=!0,tagColorFn:s=u.vm,onRemoveTag:c,onAddTag:f,...h}=e,{x:g,y:p}=(0,u.DI)(o,r,a);return(0,t.jsxs)("div",{className:l()("h-5 flex flex-col absolute px-2 text-stone-300 hover:z-50 z-40"),style:{left:g,top:p},children:[(0,t.jsx)("div",{className:"flex relative right-0 flex-col hover:gap-2 -ms-2",children:null===(n=o.tags)||void 0===n?void 0:n.map(e=>(0,t.jsx)(v,{disabled:!i,tagColorFn:s,onClick:()=>null==c?void 0:c(e),tag:e},(0,u.ix)(e)))}),i&&(0,t.jsx)(d.Z,{onSelectTag:f,...h})]})}function v(e){let{tag:n,onClick:o,tagColorFn:r=u.vm,disabled:l=!1}=e,s=r(n),c=(0,a.useMemo)(()=>"bg-".concat(s.color,"-500"),[s]);return(0,t.jsxs)("span",{className:"flex flex-row gap-1 items-center px-2 -my-2 rounded-full transition-all group bg-stone-200/0 dark:bg-stone-800/0 hover:bg-stone-200 hover:dark:bg-stone-800",children:[(0,t.jsx)("span",{className:"inline-block my-2 w-2 h-2 rounded-full ".concat(c," ring-1 ring-stone-900 opacity-100")}),(0,t.jsxs)("button",{type:"button",className:"hidden flex-row gap-1 items-center opacity-0 transition-all group-hover:flex group-hover:opacity-100 hover:text-red-500 text-stone-800 dark:text-stone-400",onClick:o,children:[(0,t.jsx)("span",{className:"hidden text-xs font-thin whitespace-nowrap opacity-0 transition-all group-hover:inline-block group-hover:opacity-100",children:n.key}),(0,t.jsx)("span",{className:"hidden text-sm font-medium whitespace-nowrap opacity-0 transition-all group-hover:inline-block group-hover:opacity-100",children:n.value}),!l&&(0,t.jsx)(i.Tw,{className:"inline-block w-3 h-3 stroke-2"})]})]})}},54259:function(e,n,o){var t=o(57437),r=o(97051),l=o(62756),a=o(2265),i=o(31476),s=o(4987),c=o(80207);let u=(0,a.memo)(function(e){let{text:n="add",variant:o="secondary",placement:a="bottom-start",onKeyDown:u,TagSearchBar:d=s.Z,...f}=e;return(0,t.jsx)(l.J,{as:"div",className:"inline-block text-left",children:(0,t.jsxs)(r.bv,{zIndex:20,placement:a,offset:4,enter:"transition duration-200 ease-out",enterFrom:"scale-95 opacity-0",enterTo:"scale-100 opacity-100",leave:"transition duration-150 ease-in",leaveFrom:"scale-100 opacity-100",leaveTo:"scale-95 opacity-0",portal:!0,children:[(0,t.jsx)(l.J.Button,{as:"div",children:(0,t.jsxs)(c.Z,{mode:"text",variant:o,padding:"py-1",children:[(0,t.jsx)(i.dt,{className:"inline-block w-5 h-5 align-middle"}),n]})}),(0,t.jsx)(l.J.Panel,{className:"w-72",focus:!0,children:e=>{let{close:n}=e;return(0,t.jsx)(d,{onKeyDown:e=>{if("Escape"===e.key){n();return}null==u||u(e)},...f})}})]})})});n.Z=u},55047:function(e,n,o){o.d(n,{Z:function(){return l}});var t=o(57437),r=o(83470);function l(){let{text:e=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.jsxs)("div",{className:"flex flex-row justify-center items-center w-full h-full",children:[(0,t.jsx)(r.Z,{})," ",e]})}},4523:function(e,n,o){o.d(n,{Z:function(){return u}});var t=o(99730),r=o(42437),l=o(76168),a=o(2676);let i={fillColor:"red",fillAlpha:1,radius:4};function s(e,n){var o,t,r,l;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;if((null!==(o=a.fillAlpha)&&void 0!==o?o:1)!==0){let{coordinates:o}=n,[i,s]=o;e.fillStyle=null!==(t=a.fillColor)&&void 0!==t?t:"red",e.globalAlpha=null!==(r=a.fillAlpha)&&void 0!==r?r:1,e.beginPath(),e.arc(i,s,null!==(l=a.radius)&&void 0!==l?l:4,0,2*Math.PI,!0),e.fill()}}var c=o(25200);function u(e,n,o){let{type:u}=n;switch(u){case"TimeStamp":(0,a.Z)(e,n.coordinates,o);break;case"TimeInterval":let[d,f]=n.coordinates;(0,r.Z)(e,{min:d,max:f},o);break;case"BoundingBox":(0,t.Z)(e,n.coordinates,o);break;case"Point":s(e,n,o);break;case"MultiPoint":!function(e,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i,{coordinates:t}=n;t.forEach(n=>{s(e,{type:"Point",coordinates:n},o)})}(e,n,o);break;case"LineString":(0,l.s6)(e,n,o);break;case"MultiLineString":(0,l.F$)(e,n,o);break;case"Polygon":(0,c.is)(e,n,o);break;case"MultiPolygon":(0,c.$W)(e,n,o);break;default:console.error("Cannot draw unknown geometry type ".concat(u))}}},42437:function(e,n,o){o.d(n,{X:function(){return r},Z:function(){return l}});var t=o(50639);let r={fillColor:"red",fillAlpha:.5,borderWidth:1,borderAlpha:1};function l(e,n){var o,l;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,{canvas:i}=e,{height:s}=i,{min:c,max:u}=n;(null!==(o=a.borderAlpha)&&void 0!==o?o:1)!==0&&((0,t.F6)(e,a),e.beginPath(),e.moveTo(c,0),e.lineTo(c,s),e.stroke(),e.beginPath(),e.moveTo(u,0),e.lineTo(u,s),e.stroke()),(null!==(l=a.fillAlpha)&&void 0!==l?l:.5)!==0&&((0,t.wi)(e,a),e.fillRect(c,0,u-c,s))}},76168:function(e,n,o){o.d(n,{F$:function(){return a},nK:function(){return r},s6:function(){return l}});var t=o(50639);let r={borderColor:"red",borderWidth:2,borderAlpha:1};function l(e,n){var o;let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;if((null!==(o=l.borderAlpha)&&void 0!==o?o:1)!==0){let{coordinates:o}=n;if(o.length<2)return;(0,t.F6)(e,l),e.beginPath();let[r,a]=o[0];e.moveTo(r,a),o.slice(1).forEach(n=>{let[o,t]=n;e.lineTo(o,t)}),e.stroke()}}function a(e,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,{coordinates:t}=n;t.forEach(n=>{l(e,{type:"LineString",coordinates:n},o)})}},25200:function(e,n,o){o.d(n,{$W:function(){return a},is:function(){return l}});let t={borderColor:"red",borderWidth:1,borderAlpha:1,fillAlpha:.5,fillColor:"red"};function r(e,n){if(n.length<2){console.error("Invalid linering. Needs at least two points");return}let[o,t]=n[0];e.moveTo(o,t),n.slice(1).forEach(n=>{let[o,t]=n;return e.lineTo(o,t)}),e.lineTo(o,t)}function l(e,n){var o,l,a,i,s,c;let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,{coordinates:d}=n;if(0===d.length){console.error("Polygon has no exterior ring");return}let f=d[0];if(f.length<2){console.error("Invalid exterior ring for polygon");return}let[h,v]=f[0];e.beginPath(),r(e,f),d.slice(1).forEach(n=>{if(n.length<2){console.error("Invalid interior ring for polygon");return}r(e,n),e.moveTo(h,v)}),e.closePath(),e.fillStyle=null!==(l=null!==(o=u.fillColor)&&void 0!==o?o:u.borderColor)&&void 0!==l?l:"red",e.globalAlpha=null!==(a=u.fillAlpha)&&void 0!==a?a:1,e.fill("evenodd"),e.strokeStyle=null!==(i=u.borderColor)&&void 0!==i?i:"red",e.lineWidth=null!==(s=u.borderWidth)&&void 0!==s?s:1,e.globalAlpha=null!==(c=u.borderAlpha)&&void 0!==c?c:1,u.borderDash&&e.setLineDash(u.borderDash),e.stroke()}function a(e,n){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,{coordinates:r}=n;r.forEach(n=>{l(e,{type:"Polygon",coordinates:n},o)})}},64063:function(e,n,o){o.d(n,{Z:function(){return s}});var t=o(2265),r=o(4523),l=o(50639),a=o(43289);let i={borderColor:l.Ej,fillColor:l.Ej,borderWidth:2,fillAlpha:.1};function s(e){let{viewport:n,soundEvents:o}=e;return(0,t.useCallback)(e=>{for(let t of o){let o=(0,a.w9)({width:e.canvas.width,height:e.canvas.height},t.sound_event.geometry,n);(0,r.Z)(e,o,i)}},[n,o])}}}]);