(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9650],{6554:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/privacy-requests/[id]",function(){return i(19774)}])},77213:function(e,t,i){"use strict";i.d(t,{Z:function(){return p}});var n=i(24246),s=i(13577),a=i(88038),l=i.n(a),r=i(86677);i(27378);var o=i(25980),c=i(90867),d=i(77830),u=()=>{let e=(0,r.useRouter)();return(0,n.jsx)(s.xuv,{bg:"gray.50",border:"1px solid",borderColor:"blue.400",borderRadius:"md",justifyContent:"space-between",p:5,mb:5,mt:5,children:(0,n.jsxs)(s.xuv,{children:[(0,n.jsxs)(s.Kqy,{direction:{base:"column",sm:"row"},justifyContent:"space-between",children:[(0,n.jsx)(s.xvT,{fontWeight:"semibold",children:"Configure your storage and messaging provider"}),(0,n.jsx)(s.wpx,{onClick:()=>{e.push(d.fz)},children:"Configure"})]}),(0,n.jsxs)(s.xvT,{children:["Before Fides can process your privacy requests we need two simple steps to configure your storage and email client."," "]})]})})},p=e=>{let{children:t,title:i,padded:a=!0,mainProps:d}=e,p=(0,o.hz)(),m=(0,r.useRouter)(),h="/privacy-requests"===m.pathname||"/datastore-connection"===m.pathname,x=!(p.flags.privacyRequestsConfiguration&&h),{data:g}=(0,c.JE)(void 0,{skip:x}),{data:j}=(0,c.PW)(void 0,{skip:x}),y=p.flags.privacyRequestsConfiguration&&(!g||!j)&&h;return(0,n.jsxs)(s.kCb,{"data-testid":i,direction:"column",h:"100vh",children:[(0,n.jsxs)(l(),{children:[(0,n.jsxs)("title",{children:["Fides Admin UI - ",i]}),(0,n.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsxs)(s.kCb,{as:"main",direction:"column",py:a?6:0,px:a?10:0,h:a?"calc(100% - 48px)":"full",flex:1,minWidth:0,overflow:"auto",...d,children:[y?(0,n.jsx)(u,{}):null,t]})]})}},19774:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return eD}});var n,s,a,l,r=i(24246),o=i(13577),c=i(86677),d=i(77213),u=i(77830),p=i(58754),m=i(99716),h=i(27378),x=i(68309),g=i(19904);(n=a||(a={})).IN_PROCESSING="in_processing",n.PENDING="pending",n.COMPLETE="complete",n.ERROR="error",n.PAUSED="paused",n.AWAITING_PROCESSING="awaiting_processing",n.RETRYING="retrying",n.SKIPPED="skipped";let j={in_processing:"In processing",pending:"Pending",complete:"Complete",error:"Error",paused:"Paused",awaiting_processing:"Awaiting input",retrying:"Retrying",skipped:"Skipped"},y={error:"error",skipped:"warning",awaiting_processing:"minos",in_processing:void 0,pending:void 0,complete:void 0,paused:void 0,retrying:void 0};(s=l||(l={})).REQUEST_UPDATE="Request update",s.INTERNAL_COMMENT="Internal comment";let v={"Request update":"sandstone","Internal comment":"marble"};var f=i(90005),_=i.n(f),b=i(16394),w=i(38450),T=i.n(w),R=e=>{let{item:t}=e,{author:i,title:n,date:s,type:a,onClick:c,isError:d,isSkipped:u,isAwaitingInput:p,description:m}=t,h=(0,b.p6)(s),x=!!c,g=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:T().header,children:[(0,r.jsxs)("span",{className:T().author,"data-testid":"activity-timeline-author",children:[i,":"]}),n&&(0,r.jsxs)("span",{className:_()(T().title,{[T()["title--error"]]:d,[T()["title--awaiting-input"]]:p}),"data-testid":"activity-timeline-title",children:[n,d&&" failed"]}),(0,r.jsx)("span",{className:T().timestamp,"data-testid":"activity-timeline-timestamp",children:h}),(0,r.jsx)(o.j8w,{className:T().type,color:v[a],"data-testid":"activity-timeline-type",children:a}),(d||u||p)&&(0,r.jsx)("span",{className:T().viewLogs,"data-testid":"activity-timeline-view-logs",children:"View Log"})]}),m&&(0,r.jsx)("div",{className:"mt-2 pl-2.5",children:(0,r.jsx)(o.AntTypography.Paragraph,{className:"!mb-0 whitespace-pre-wrap",children:m})})]}),j={className:_()(T().itemButton,{[T()["itemButton--error"]]:d,[T()["itemButton--awaiting-input"]]:p,[T()["itemButton--clickable"]]:x,[T()["itemButton--comment"]]:a===l.INTERNAL_COMMENT}),"data-testid":"activity-timeline-item"};return x?(0,r.jsx)("button",{type:"button",onClick:c,...j,children:g}):(0,r.jsx)("div",{...j,children:g})},q=i(25980),C=i(54427),E=i(78780);let{useGetCommentsQuery:A,useCreateCommentMutation:k,useGetCommentDetailsQuery:S,useLazyGetCommentDetailsQuery:N}=E.u.injectEndpoints({endpoints:e=>({getComments:e.query({query:e=>{let{privacy_request_id:t,page:i=1,size:n}=e;return{url:"plus/privacy-request/".concat(t,"/comment"),method:"GET",params:{page:i,size:n}}},providesTags:["Privacy Request Comments"]}),createComment:e.mutation({query:e=>{let{privacy_request_id:t,comment_text:i,comment_type:n}=e,s=new FormData;return s.append("comment_text",i),s.append("comment_type",n),{url:"plus/privacy-request/".concat(t,"/comment"),method:"POST",body:s,formData:!0}},invalidatesTags:["Privacy Request Comments","Request"]}),getCommentDetails:e.query({query:e=>{let{privacy_request_id:t,comment_id:i}=e;return{url:"plus/privacy-request/".concat(t,"/comment/").concat(i),method:"GET"}}})})}),{reducer:P}=(0,C.oM)({name:"privacyRequestComments",initialState:{},reducers:{}}),I=e=>{let{plus:t}=(0,q.hz)(),{data:i,isLoading:n,error:s}=A({privacy_request_id:e,size:100},{skip:!t});return(0,h.useEffect)(()=>{s&&o.Pg3.error("Failed to fetch the request comments")},[s]),{commentItems:(null==i?void 0:i.items)?i.items.map(e=>({author:e.user_first_name&&e.user_last_name?"".concat(e.user_first_name," ").concat(e.user_last_name):e.username||"Unknown",date:new Date(e.created_at),type:l.INTERNAL_COMMENT,showViewLog:!1,description:e.comment_text,isError:!1,isSkipped:!1,isAwaitingInput:!1,id:"comment-".concat(e.id)})):[],isLoading:n}},O=e=>{let t=!e;return{eventItems:e?Object.entries(e).map(e=>{let[t,i]=e,n=i.some(e=>e.status===a.ERROR),s=i.some(e=>e.status===a.SKIPPED),r=i.some(e=>e.status===a.AWAITING_PROCESSING);return{author:"Fides",title:t,date:new Date(i[0].updated_at),type:l.REQUEST_UPDATE,showViewLog:n||s||r,onClick:()=>{},isError:n,isSkipped:s,isAwaitingInput:r,id:"request-".concat(t)}}):[],isLoading:t}};var D=i(88340),U=e=>{let{errorMessage:t,status:i=a.ERROR}=e;return(0,r.jsxs)(o.xuv,{height:"100%",id:"outer",children:[(0,r.jsxs)(o.kCb,{alignItems:"center",children:[(0,r.jsx)(o.xvT,{size:"sm",color:"gray.700",fontWeight:"medium",marginRight:"8px",lineHeight:"20px",children:"Status"}),(0,r.jsx)(o.j8w,{color:y[i],children:j[i]}),(0,r.jsx)(o.xuv,{padding:"0px",marginBottom:"3px",children:(0,r.jsx)(D.Z,{copyText:t})})]}),(0,r.jsx)(o.izJ,{marginTop:"4px",marginBottom:"6px"}),(0,r.jsx)(o.xuv,{id:"errorWrapper",overflow:"auto",height:"100%",children:(0,r.jsx)(o.xvT,{children:t})})]})},M=i(3124),z=i.n(M);let W=e=>{switch(e){case x.Us.ACCESS:return"Data Retrieval";case x.Us.ERASURE:return"Data Deletion";case x.Us.CONSENT:return"Consent";case x.Us.UPDATE:return"Data Update";default:return e}};var L=e=>{let{eventLogs:t,onDetailPanel:i}=e,n=null==t?void 0:t.map(e=>(0,r.jsxs)(o.Tr,{backgroundColor:e.status===a.ERROR||e.status===a.SKIPPED&&e.message||e.status===a.AWAITING_PROCESSING?z().FIDESUI_NEUTRAL_50:"unset",onClick:()=>{(e.status===a.ERROR||e.status===a.SKIPPED&&e.message||e.status===a.AWAITING_PROCESSING)&&i(e.message,e.status)},style:{cursor:e.message?"pointer":"unset"},_hover:{backgroundColor:z().FIDESUI_NEUTRAL_50},children:[(0,r.jsx)(o.Td,{children:(0,r.jsx)(o.xvT,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:(0,b.p6)(e.updated_at)})}),(0,r.jsx)(o.Td,{children:(0,r.jsx)(o.xvT,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:W(e.action_type)})}),(0,r.jsx)(o.Td,{children:(0,r.jsx)(o.j8w,{color:y[e.status],children:j[e.status]})}),(0,r.jsx)(o.Td,{children:(0,r.jsx)(o.xvT,{color:"gray.600",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:e.collection_name})})]},e.updated_at));return(0,r.jsx)(o.xuv,{width:"100%",paddingTop:"0px",height:"100%",children:(0,r.jsx)(o.xJi,{id:"tableContainer",height:"100%",style:{overflowY:"auto"},children:(0,r.jsxs)(o.iA_,{size:"sm",id:"table",position:"relative",children:[(0,r.jsx)(o.hrZ,{id:"tableHeader",position:"sticky",top:"0px",backgroundColor:"white",children:(0,r.jsxs)(o.Tr,{children:[(0,r.jsx)(o.Th,{children:(0,r.jsx)(o.xvT,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Time"})}),(0,r.jsx)(o.Th,{children:(0,r.jsx)(o.xvT,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Action Type"})}),(0,r.jsx)(o.Th,{children:(0,r.jsx)(o.xvT,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Status"})}),(0,r.jsx)(o.Th,{children:(0,r.jsx)(o.xvT,{color:"black",fontSize:"xs",lineHeight:"4",fontWeight:"medium",children:"Collection"})})]})}),(0,r.jsx)(o.p3B,{id:"tableBody",children:n})]})})})},B=e=>{let{isOpen:t,onClose:i,currentLogs:n,isViewingError:s,errorMessage:l,currentStatus:c=a.ERROR,onCloseErrorPanel:d,onOpenErrorPanel:u}=e;return(0,r.jsxs)(o.dys,{isOpen:t,placement:"right",onClose:i,size:"full",autoFocus:!1,"data-testid":"log-drawer",children:[(0,r.jsx)(o.P1B,{}),(0,r.jsxs)(o.scA,{style:{width:"50%"},"data-testid":"log-drawer",children:[(0,r.jsx)(o.OXI,{style:{paddingBottom:"0px"},children:(0,r.jsxs)(o.kCb,{justifyContent:"space-between",alignItems:"center",height:"40px",children:[(0,r.jsxs)(o.kCb,{alignItems:"center",children:[s&&(0,r.jsx)(o.wpx,{icon:(0,r.jsx)(o.Rpv,{}),"aria-label":"Close error logs",size:"small",onClick:d}),(0,r.jsx)(o.xvT,{color:"gray.900",fontSize:"md",lineHeight:"6",fontWeight:"medium",ml:1,children:s?"Event detail":"Event log"})]}),(0,r.jsx)(o.wpx,{icon:(0,r.jsx)(o.LGN,{width:"17px"}),"aria-label":"Stop viewing error message",size:"small",onClick:i,"data-testid":"log-drawer-close"})]})}),(0,r.jsxs)(o.Ng0,{id:"drawerBody",overflow:"hidden",children:[n&&!s?(0,r.jsx)(L,{eventLogs:n,onDetailPanel:u}):null,s?(0,r.jsx)(U,{errorMessage:l,status:c}):null]})]})]})},F=e=>{let{subjectRequest:t}=e,{isOpen:i,onOpen:n,onClose:s}=(0,o.qY0)(),[c,d]=(0,h.useState)([]),[u,p]=(0,h.useState)(""),[m,x]=(0,h.useState)(!1),[g,j]=(0,h.useState)(""),[y,v]=(0,h.useState)(a.ERROR),{results:f,id:_}=t,{commentItems:b,isLoading:w}=I(_),{eventItems:q,isLoading:C}=O(f);(0,h.useEffect)(()=>{u&&f&&f[u]&&d(f[u])},[f,u]);let E=()=>{x(!1)},A=(0,h.useCallback)((e,t)=>{p(e),d(t),n()},[n]),k=(0,h.useMemo)(()=>{let e=q.map(e=>{if("Request update"===e.type&&e.title&&f){let t=e.title;if(f[t])return{...e,onClick:()=>A(t,f[t])}}return e});return[{author:"Fides",title:"Access request received",date:new Date(t.created_at),type:l.REQUEST_UPDATE,showViewLog:!1,isError:!1,isSkipped:!1,isAwaitingInput:!1,id:"initial-request"},...e,...b].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())},[q,b,f,A,t.created_at]);return(0,r.jsxs)(o.xuv,{width:"100%",children:[(0,r.jsx)(o.krs,{className:"!border-none",bordered:!1,split:!1,"data-testid":"activity-timeline-list",children:(0,r.jsx)("ul",{className:"!list-none",children:w||C?(0,r.jsx)("div",{className:T().itemButton,"data-testid":"timeline-skeleton",children:(0,r.jsx)(o.N_L,{paragraph:{rows:2},active:!0})}):k.map(e=>(0,r.jsx)("li",{children:(0,r.jsx)(R,{item:e})},e.id))})}),(0,r.jsx)(B,{isOpen:i,onClose:()=>{m&&E(),p(""),s()},currentLogs:c,isViewingError:m,errorMessage:g,currentStatus:y,onOpenErrorPanel:(e,t)=>{j(e),t&&v(t),x(!0)},onCloseErrorPanel:E})]})},G=i(66187);let Z=e=>{let{privacyRequestId:t,onCancel:i}=e,[n,s]=(0,h.useState)(""),a=(0,h.useRef)(null),[l,{isLoading:c}]=k();(0,h.useEffect)(()=>{a.current&&a.current.focus()},[]);let d=async()=>{if(n.trim())try{await l({privacy_request_id:t,comment_text:n,comment_type:G.i.NOTE}).unwrap(),s(""),i()}catch(e){console.error("Failed to add comment:",e),o.Pg3.error({content:"Failed to add comment",duration:5})}},u=[{key:"internal",label:"Internal comment",children:(0,r.jsx)(o.uFc.TextArea,{ref:a,value:n,onChange:e=>s(e.target.value),rows:3,className:"mb-3 h-[150px] w-full !resize-none","data-testid":"comment-input"})}];return(0,r.jsxs)("div",{children:[(0,r.jsx)(o.A5g,{items:u}),(0,r.jsxs)(o.jqI,{justify:"flex-end",className:"gap-2",children:[(0,r.jsx)(o.wpx,{onClick:i,"data-testid":"cancel-comment-button",children:"Cancel"}),(0,r.jsx)(o.wpx,{onClick:d,loading:c,disabled:!n.trim(),type:"primary",htmlType:"button","data-testid":"submit-comment-button",children:"Save"})]})]})};var J=e=>{let{subjectRequest:t}=e,[i,n]=(0,h.useState)(!1);return(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsx)(F,{subjectRequest:t}),i?(0,r.jsx)(Z,{privacyRequestId:t.id,onCancel:()=>n(!1)}):(0,r.jsx)(g.ZP,{scopes:[x.Sh.COMMENT_CREATE],children:(0,r.jsx)(o.jqI,{justify:"flex-start",className:"mt-2",children:(0,r.jsxs)(o.wpx,{type:"default",onClick:()=>n(!0),className:"flex items-center","data-testid":"add-comment-button",children:["Add comment ",(0,r.jsx)("span",{className:"ml-1",children:"+"})]})})})]})},H=i(14207),V=i(46238),Y=i(45116),K=i(72281),Q=i(14047),X=i(90867),$=i(16134);let ee=e=>Array.from(new Set(e.filter(e=>Object.values(x.Us).includes(e.action_type)).map(e=>e.action_type)));var et=e=>{let{rules:t}=e,i=ee(t).map(e=>(0,b.kC)(e)).map(e=>e);return(0,r.jsx)(o.AntTypography.Text,{children:i.join(" - ")})},ei=i(34090),en=i(55484),es=e=>{let{connectorName:t,data:i,isSubmitting:n=!1,onSaveClick:s}=e,{isOpen:a,onOpen:l,onClose:c}=(0,o.qY0)(),d=(0,h.useRef)(null),u=async(e,t)=>{s({connection_key:i.connection_key,privacy_request_id:i.privacy_request_id,body:{...e}}),c()};return(0,r.jsxs)(r.Fragment,{children:[(null==i?void 0:i.checked)&&(0,r.jsx)(o.wpx,{onClick:l,size:"small",children:"Review"}),!(null==i?void 0:i.checked)&&(0,r.jsx)(o.wpx,{onClick:l,size:"small",type:"primary",children:"Begin manual input"}),(0,r.jsx)(ei.J9,{enableReinitialize:!0,initialValues:{...i.fields},onSubmit:u,validateOnBlur:!1,validateOnChange:!1,validationSchema:en.Ry().shape({}),children:e=>(0,r.jsxs)(o.dys,{isOpen:a,placement:"right",initialFocusRef:d,onClose:c,size:"lg",children:[(0,r.jsx)(o.P1B,{}),(0,r.jsxs)(o.scA,{children:[(0,r.jsx)(o.cCv,{}),(0,r.jsxs)(o.OXI,{color:"gray.900",children:[(0,r.jsx)(o.xvT,{fontSize:"xl",mb:8,children:t}),(0,r.jsx)(o.izJ,{}),(0,r.jsx)(o.xvT,{fontSize:"md",mt:"4",children:"Manual access"}),(0,r.jsx)(o.xuv,{mt:"8px",children:(0,r.jsx)(o.xvT,{color:"gray.700",fontSize:"sm",fontWeight:"normal",children:"Please complete the following PII fields that have been collected for the selected subject."})})]}),(0,r.jsx)(o.Ng0,{children:(0,r.jsx)(ei.l0,{id:"manual-detail-form",noValidate:!0,children:(0,r.jsx)(o.gCW,{align:"stretch",gap:"16px",children:Object.entries(i.fields).map((e,t)=>{let[i]=e;return(0,r.jsx)(o.Ugi,{children:(0,r.jsx)(ei.gN,{id:i,name:i,children:e=>{let{field:n}=e;return(0,r.jsxs)(o.NIc,{alignItems:"baseline",display:"inline-flex",children:[(0,r.jsx)(o.lXp,{color:"gray.900",fontSize:"14px",fontWeight:"semibold",htmlFor:i,w:"50%",children:i}),(0,r.jsx)(o.IIB,{...n,autoComplete:"off",color:"gray.700",placeholder:"Please enter ".concat(i),ref:0===t?d:void 0,size:"sm"})]})}})},i)})})})}),(0,r.jsx)(o.zeN,{justifyContent:"flex-start",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(o.wpx,{onClick:c,children:"Cancel"}),(0,r.jsx)(o.wpx,{form:"manual-detail-form",loading:n,htmlType:"submit",children:"Save"})]})})]})]})})]})},ea=e=>{let{connectorName:t,data:i,isSubmitting:n=!1,onSaveClick:s}=e,{isOpen:a,onOpen:l,onClose:c}=(0,o.qY0)(),d=(0,h.useRef)(null),u=async(e,t)=>{s({connection_key:i.connection_key,privacy_request_id:i.privacy_request_id,body:{...e}}),c()};return(0,r.jsxs)(r.Fragment,{children:[(null==i?void 0:i.checked)&&(0,r.jsx)(o.wpx,{onClick:l,size:"small",children:"Review"}),!(null==i?void 0:i.checked)&&(0,r.jsx)(o.wpx,{onClick:l,size:"small",type:"primary",children:"Begin manual input"}),(0,r.jsx)(ei.J9,{enableReinitialize:!0,initialValues:{...i.fields},onSubmit:u,validateOnBlur:!1,validateOnChange:!1,validationSchema:en.Ry().shape({}),children:e=>(0,r.jsxs)(o.dys,{isOpen:a,placement:"right",initialFocusRef:d,onClose:c,size:"lg",children:[(0,r.jsx)(o.P1B,{}),(0,r.jsxs)(o.scA,{children:[(0,r.jsx)(o.cCv,{}),(0,r.jsxs)(o.OXI,{color:"gray.900",children:[(0,r.jsx)(o.xvT,{fontSize:"xl",mb:8,children:t}),(0,r.jsx)(o.izJ,{}),(0,r.jsx)(o.xvT,{fontSize:"md",mt:"4",children:"Manual erasure"}),(0,r.jsx)(o.xuv,{mt:"8px",children:(0,r.jsx)(o.xvT,{color:"gray.700",fontSize:"sm",fontWeight:"normal",children:"Please delete the following PII fields associated with the selected subject if they are available. Once deleted, check the box to confirm the deletion."})})]}),(0,r.jsx)(o.Ng0,{children:(0,r.jsx)(ei.l0,{id:"manual-detail-form",noValidate:!0,children:(0,r.jsx)(o.gCW,{align:"stretch",gap:"16px",children:Object.entries(i.fields).map(e=>{let[t]=e;return(0,r.jsx)(o.Ugi,{children:(0,r.jsx)(ei.gN,{id:t,name:t,children:e=>{let{field:i}=e;return(0,r.jsxs)(o.NIc,{alignItems:"baseline",display:"inline-flex",children:[(0,r.jsx)(o.lXp,{color:"gray.900",fontSize:"14px",fontWeight:"semibold",htmlFor:t,w:"50%",children:t}),(0,r.jsx)(o.XZJ,{...i,isChecked:!!i.value,onChange:i.onChange,name:t,id:t})]})}})},t)})})})}),(0,r.jsx)(o.zeN,{justifyContent:"flex-start",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(o.wpx,{onClick:c,children:"Cancel"}),(0,r.jsx)(o.wpx,{form:"manual-detail-form",loading:n,htmlType:"submit",children:"Save"})]})})]})]})})]})};let el=(e,t,i)=>e.includes(x.Us.ACCESS)?{ProcessingDetailComponent:es,uploadMutation:t,getUploadedWebhookDataEndpoint:X.$I.endpoints.getUploadedManualAccessWebhookData}:e.includes(x.Us.ERASURE)?{ProcessingDetailComponent:ea,uploadMutation:i,getUploadedWebhookDataEndpoint:X.$I.endpoints.getUploadedManualErasureWebhookData}:null;var er=e=>{let{subjectRequest:t,onComplete:i}=e,n=(0,$.T)(),{errorAlert:s,successAlert:a}=(0,Q.V)(),{handleError:l}=(0,Q.H)(),[c,d]=(0,h.useState)([]),[u,p]=(0,h.useState)(!1),[m,g]=(0,h.useState)(!1),{data:j,isFetching:y,isLoading:v,isSuccess:f}=(0,H.W6)(),[_]=(0,X.w3)(),b=ee(t.policy.rules),[w]=(0,X.nL)(),[T]=(0,X.UR)(),{ProcessingDetailComponent:R,uploadMutation:q,getUploadedWebhookDataEndpoint:C}=el(b,w,T),E=async()=>{try{p(!0),await _(t.id).unwrap(),a("Manual request has been received. Request now processing."),i()}catch(e){l(e)}finally{p(!1)}},A=async e=>{try{g(!0),await q(e).unwrap();let t={connection_key:e.connection_key,fields:{}};Object.entries(e.body).forEach(e=>{let[i,n]=e;t.fields[i]=n||""});let i=c.map(e=>e.connection_key===t.connection_key?{...e,checked:!0,fields:{...t.fields}}:e);d(i),a("Manual input successfully saved!")}catch(e){l(e)}finally{g(!1)}};return((0,h.useEffect)(()=>(f&&j.length>0&&0===c.length&&(()=>{if(c.length>0)return;let e=[],i=null==j?void 0:j.map(e=>e.connection_config.key);null==i||i.every(i=>e.push(n(C.initiate({connection_key:i,privacy_request_id:t.id})))),Promise.allSettled(e).then(e=>{let t=[];e.forEach((e,i)=>{if("fulfilled"===e.status&&e.value.isSuccess&&e.value.data){let i={checked:e.value.data.checked,fields:{},connection_key:e.value.originalArgs.connection_key,privacy_request_id:e.value.originalArgs.privacy_request_id};Object.entries(e.value.data.fields).forEach(e=>{let[t,n]=e;i.fields[t]=n||""}),t.push(i)}else s("An error occurred while loading manual input data for ".concat(j[i].connection_config.name))}),d(t)})})(),()=>{}),[j,c.length,n,s,f,t.id,C]),b.includes(x.Us.ACCESS)||b.includes(x.Us.ERASURE))?(0,r.jsxs)(o.gCW,{align:"stretch",spacing:8,children:[(0,r.jsx)(o.xuv,{children:(0,r.jsx)(o.xvT,{color:"gray.700",fontSize:"sm",children:"The following table details the integrations that require manual input from you."})}),(0,r.jsxs)(o.xuv,{children:[(y||v)&&(0,r.jsx)(o.M5Y,{children:(0,r.jsx)(o.$jN,{})}),f&&j?(0,r.jsx)(o.xJi,{children:(0,r.jsxs)(o.iA_,{size:"sm",variant:"unstyled",children:[(0,r.jsx)(o.hrZ,{children:(0,r.jsxs)(o.Tr,{children:[(0,r.jsx)(o.Th,{fontSize:"sm",fontWeight:"semibold",pl:"0",textTransform:"none",children:"Integration Identifier"}),(0,r.jsx)(o.Th,{})]})}),(0,r.jsxs)(o.p3B,{children:[j.length>0&&j.map(e=>(0,r.jsxs)(o.Tr,{display:"block",children:[(0,r.jsx)(o.Td,{pl:"0",children:e.connection_config.key}),(0,r.jsx)(o.Td,{children:c.length>0?(0,r.jsx)(R,{connectorName:e.connection_config.name,data:c.find(t=>t.connection_key===e.connection_config.key),isSubmitting:m,onSaveClick:A}):null})]},e.id)),0===j.length&&(0,r.jsx)(o.Tr,{children:(0,r.jsx)(o.Td,{colSpan:3,pl:"0",children:(0,r.jsx)(o.M5Y,{children:(0,r.jsx)(o.xvT,{children:"You don‘t have any Manual Process connections set up yet."})})})})]}),c.length>0&&c.every(e=>e.checked)?(0,r.jsx)(o.$RU,{children:(0,r.jsx)(o.Tr,{children:(0,r.jsx)(o.Th,{pl:"0px",children:(0,r.jsx)(o.wpx,{type:"primary",loading:u,onClick:E,className:"mt-2",children:"Complete DSR"})})})}):null]})}):null]})]}):null},eo=e=>{let{subjectRequest:t,onComplete:i}=e,n=(0,c.useRouter)(),{data:s}=(0,H.AZ)({}),a=(0,h.useMemo)(()=>{var e;return(null==s?void 0:null===(e=s.items)||void 0===e?void 0:e.filter(e=>e.connection_type===x.Rj.MANUAL_TASK))||[]},[s]),{data:l}=(0,H.W6)(),d=(l||[]).length>0,{data:p}=(0,Y.Ym)({page:1,size:100,privacyRequestId:t.id}),m=(null==p?void 0:p.items)||[],g=m.length,j=m.filter(e=>e.status===x.OS.NEW).length,y=a.length>0;return y||d?(0,r.jsxs)(o.Kqy,{spacing:6,children:[y&&(0,r.jsxs)(o.xuv,{children:[(0,r.jsx)(o.AntTypography.Title,{level:4,style:{marginBottom:12},children:"Manual tasks"}),(0,r.jsxs)(o.Kqy,{spacing:2,children:[(0,r.jsxs)(o.AntTypography.Text,{children:[(0,r.jsx)("strong",{children:g})," task",1!==g?"s":""," ","linked to this privacy request"]}),(0,r.jsxs)(o.AntTypography.Text,{children:[(0,r.jsx)("strong",{children:j})," pending task",1!==j?"s":""]}),g>0&&(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)(o.wpx,{type:"primary",onClick:()=>{n.push({pathname:u.Jw,query:{privacy_request_id:t.id,tab:K.G.MANUAL_TASK}})},children:"View all tasks for this request →"})})]})]}),d&&(0,r.jsxs)(o.xuv,{children:[(0,r.jsxs)(o.kCb,{alignItems:"center",style:{marginBottom:12},children:[(0,r.jsx)(o.AntTypography.Title,{level:4,style:{margin:0,marginRight:8},children:"Manual steps (legacy)"}),(0,r.jsx)(V.b,{label:"This is the legacy manual steps feature. The new manual tasks feature provides more advanced capabilities and better user experience."})]}),(0,r.jsx)(er,{subjectRequest:t,onComplete:i||(()=>{})})]})]}):(0,r.jsx)(o.xuv,{p:4,children:(0,r.jsx)(o.AntTypography.Text,{type:"secondary",children:"No manual tasks or legacy manual steps configured for this request."})})},ec=i(59969);let ed={approved:{color:"success",label:"Approved"},complete:{color:"success",label:"Completed"},awaiting_email_send:{color:"marble",label:"Awaiting Email Send"},denied:{color:"warning",label:"Denied"},canceled:{color:"marble",label:"Canceled"},error:{color:"error",label:"Error"},in_processing:{color:"caution",label:"In Progress"},paused:{color:"marble",label:"Paused"},pending:{color:"info",label:"New"},identity_unverified:{color:"marble",label:"Unverified"},requires_input:{color:"minos",label:"Requires Input"}};var eu=e=>{let{status:t}=e;return(0,r.jsx)(o.j8w,{color:ed[t].color,className:"justify-center","data-testid":"request-status-badge",children:ed[t].label})},ep=i(18225),em=i(812),eh=i(7842);let{useGetAttachmentsQuery:ex,useUploadAttachmentMutation:eg,useGetAttachmentDetailsQuery:ej,useLazyGetAttachmentDetailsQuery:ey}=E.u.injectEndpoints({endpoints:e=>({getAttachments:e.query({query:e=>{let{privacy_request_id:t,page:i=1,size:n}=e;return{url:"plus/privacy-request/".concat(t,"/attachment"),method:"GET",params:{page:i,size:n}}},providesTags:["Privacy Request Attachments"]}),uploadAttachment:e.mutation({query:e=>{let{privacy_request_id:t,attachment_type:i,attachment_file:n}=e,s=new FormData;return s.append("attachment_type",i),s.append("attachment_file",n),{url:"plus/privacy-request/".concat(t,"/attachment"),method:"POST",body:s,params:{}}},invalidatesTags:["Privacy Request Attachments"]}),getAttachmentDetails:e.query({query:e=>{let{privacy_request_id:t,attachment_id:i}=e;return{url:"plus/privacy-request/".concat(t,"/attachment/").concat(i),method:"GET"}}})})}),{reducer:ev}=(0,C.oM)({name:"privacyRequestAttachments",initialState:{},reducers:{}}),ef=e=>{let{file:t}=e,[i,n]=(0,h.useState)(!1),[s]=ey(),a=async()=>{var e,i,a;if((null===(e=t.customData)||void 0===e?void 0:e.attachment_id)&&(null===(i=t.customData)||void 0===i?void 0:i.privacy_request_id)){n(!0);try{let e=await s({privacy_request_id:t.customData.privacy_request_id,attachment_id:t.customData.attachment_id}),i=null===(a=e.data)||void 0===a?void 0:a.retrieved_attachment_url,n=null==i?void 0:i.startsWith("http");i&&n?window.open(i,"_blank"):i&&!n?o.Pg3.info("Download is not available when using local storage methods."):o.Pg3.error("No download URL available for ".concat(t.name))}catch(e){o.Pg3.error("Failed to fetch attachment download URL")}finally{n(!1)}}};return(0,r.jsxs)(o.jqI,{align:"center",gap:8,children:[(0,r.jsx)(o.PJP.PgN,{className:"shrink-0"}),(0,r.jsx)(o.lKn,{ellipsis:{tooltip:t.name},className:"grow",children:t.name}),(0,r.jsx)(o.wpx,{type:"text",icon:(0,r.jsx)(o.PJP.UWx,{}),onClick:a,loading:i,className:"shrink-0"})]})},e_=(e,t)=>(0,r.jsx)(ef,{file:t});var eb=e=>{let{subjectRequest:t}=e,[i,n]=(0,h.useState)(!1),s=(0,g.Tg)([x.Sh.ATTACHMENT_READ]),a=(0,g.Tg)([x.Sh.ATTACHMENT_CREATE]),[l]=eg(),{data:c,isLoading:d,error:u}=(0,X.PW)(),{data:p,isLoading:m}=ex({privacy_request_id:t.id}),{refetch:j}=ex({privacy_request_id:t.id}),y=(null==p?void 0:p.items.map(e=>({uid:e.id,name:e.file_name,status:"done",customData:{attachment_id:e.id,privacy_request_id:t.id}})))||[],v=(0,h.useCallback)(()=>(0,r.jsx)(o.PJP.PgN,{}),[]);if(!s)return null;let f=a&&(null==c?void 0:c.key),_=[".pdf",".doc",".docx",".xls",".xlsx",".txt",".csv",".jpg",".jpeg",".png",".zip"];return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(o.lQT,{level:3,children:"Attachments"})}),d||m?(0,r.jsx)(ep.Z,{size:"md",alignment:"start"}):(0,r.jsx)(o.pMK,{name:"attachment_file",fileList:y,iconRender:v,showUploadList:{showRemoveIcon:!1,showDownloadIcon:!1},itemRender:e_,accept:_.join(","),customRequest:async e=>{let{file:i,onSuccess:s,onError:a}=e,r=i.name;try{n(!0),await l({privacy_request_id:t.id,attachment_file:i,attachment_type:eh.s.INTERNAL_USE_ONLY}).unwrap(),o.Pg3.success("".concat(r," file uploaded successfully")),j(),null==s||s(i)}catch(e){o.Pg3.error("".concat(r," file upload failed.")),null==a||a(e)}finally{n(!1)}},disabled:!f,children:a&&(0,r.jsx)(o.esZ,{title:u&&"Add attachment not available: ".concat((0,em.e$)(u)),placement:"top",children:(0,r.jsxs)(o.jqI,{align:"center",gap:12,className:"mb-4",children:[(0,r.jsx)(o.wpx,{icon:(0,r.jsx)(o.PJP.mm_,{}),iconPosition:"end",disabled:!f||i,loading:i,children:i?"Uploading":"Add"}),(0,r.jsx)(V.b,{label:"Uploaded attachments are for internal use and won't be send as part of the request package.\n                      Accepted filetypes: ".concat(_.join(", ")),placement:"top"})]})})})]})})},ew=i(15709),eT=i.n(ew),eR=e=>{let{label:t,children:i}=e;return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"shrink-0 grow-0 basis-1/2 pr-2 ".concat(eT().label),children:(0,r.jsxs)(o.AntTypography.Text,{children:[t,":"]})}),(0,r.jsx)("div",{className:"min-w-0 shrink grow ".concat(eT().value),"data-testid":"request-detail-value-".concat(t),children:i})]})},eq=e=>{let{subjectRequest:t}=e,{custom_privacy_request_fields:i}=t;return(0,r.jsx)("div",{className:"flex flex-col gap-2",children:i&&Object.keys(i).length>0&&Object.entries(i).filter(e=>{let[,t]=e;return t.value}).map(e=>{let[t,i]=e;return(0,r.jsx)(eR,{label:i.label,children:(0,r.jsx)(o.AntTypography.Text,{children:Array.isArray(i.value)?i.value.join(", "):i.value})},t)})})},eC=e=>{let{subjectRequest:t}=e,{plus:i}=(0,q.hz)(),{id:n,status:s,policy:a,identity:l,identity_verified_at:c}=t;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(o.AntTypography.Title,{level:2,children:"Request details"})}),(0,r.jsxs)(o.jqI,{vertical:!0,gap:12,className:"mb-6",children:[(0,r.jsx)(eR,{label:"Status",children:(0,r.jsx)(eu,{status:s})}),(0,r.jsx)(eR,{label:"Time remaining",children:(0,r.jsx)(ec.Z,{daysLeft:t.days_left,includeText:!0,status:t.status})}),(0,r.jsx)(eR,{label:"Request type",children:(0,r.jsx)(et,{rules:a.rules})}),(0,r.jsx)(eR,{label:"Source",children:i&&(0,r.jsx)(o.AntTypography.Text,{children:t.source||"-"})}),Object.entries(l).filter(e=>{let[,{value:t}]=e;return null!==t}).map(e=>{let[t,{value:i="",label:n}]=e,s="".concat(i).concat(c?"":" (Unverified)");return(0,r.jsx)(eR,{label:"Subject ".concat(n.toLocaleLowerCase()),children:(0,r.jsx)(o.esZ,{title:s,trigger:"click",children:(0,r.jsx)(o.AntTypography.Text,{ellipsis:!0,children:s})})},t)}),(0,r.jsx)(eq,{subjectRequest:t})]}),(0,r.jsxs)(o.PPS,{layout:"vertical",children:[(0,r.jsx)(o.PPS.Item,{label:"Request ID:",className:"mb-4",children:(0,r.jsx)(o.jqI,{gap:1,children:(0,r.jsxs)(o.vyj.Compact,{style:{width:"100%"},children:[(0,r.jsx)(o.uFc,{readOnly:!0,value:n,"data-testid":"request-detail-value-id"}),(0,r.jsx)(o.wpx,{icon:(0,r.jsx)(D.Z,{copyText:n})})]})})}),(0,r.jsx)(o.PPS.Item,{label:"Policy key:",className:"mb-4",children:(0,r.jsx)(o.uFc,{readOnly:!0,value:t.policy.key,"data-testid":"request-detail-value-policy"})})]}),(0,r.jsx)(eb,{subjectRequest:t})]})},eE=e=>{var t;let{data:i}=e,n=(0,h.useMemo)(()=>({id:i.id,verbose:!0}),[i.id]),{data:s}=(0,m.QA)(n,{pollingInterval:i.status===x.q2.APPROVED||i.status===x.q2.IN_PROCESSING?2e3:0,skip:!i.id}),a=null!==(t=null==s?void 0:s.items[0])&&void 0!==t?t:i,l=a.status===x.q2.REQUIRES_INPUT,[c,d]=(0,h.useState)("activity"),u=(0,h.useMemo)(()=>[{key:"activity",label:"Activity",children:(0,r.jsx)(J,{subjectRequest:a})},{key:"manual-tasks",label:"Manual tasks",children:(0,r.jsx)(eo,{subjectRequest:a,onComplete:()=>d("activity")}),disabled:!l}],[l,a]);return(0,r.jsxs)("div",{className:"flex gap-8",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(o.A5g,{items:u,activeKey:c,onChange:d})}),(0,r.jsx)("div",{className:"w-1/3 2xl:w-[432px]","data-testid":"privacy-request-details",children:(0,r.jsx)(eC,{subjectRequest:a})})]})},eA=i(57526),ek=i(66548),eS=i(45489),eN=e=>{let{privacyRequest:t,action:i}=e,{handleApproveRequest:n,handleDenyRequest:s}=(0,eS.Z)({subjectRequest:t}),a=t.status===x.q2.PENDING,l=(0,o.qY0)(),r=async e=>{let{reason:t}=e,a=o.Pg3.loading({content:"approve"===i?"Approving request...":"Denying request..."});"deny"===i&&await s(t),"approve"===i&&await n(),a()};return{showAction:a,closeModal:l.onClose,performAction:r,openConfirmationModal:l.onOpen,isModalOpen:l.isOpen}},eP=e=>{var t,i,n;let{privacyRequest:s}=e,a=null===(i=(0,q.hz)())||void 0===i?void 0:null===(t=i.flags)||void 0===t?void 0:t.downloadAccessRequestResults,l=s.status===x.q2.COMPLETE,r=ee(s.policy.rules).includes(x.Us.ACCESS),o=(0,g.Tg)([x.Sh.PRIVACY_REQUEST_ACCESS_RESULTS_READ]),{data:c,isLoading:d,isError:u,error:p}=(0,X.br)({privacy_request_id:s.id}),m=null!==(n=null==c?void 0:c.access_result_urls[0])&&void 0!==n?n:"",h=!!m&&"your local fides_uploads folder"!==m,j=null;return u?j=(0,em.e$)(p,"Unable to resolve download URL"):h||(j="Requests stored locally cannot be downloaded"),{showDownloadResults:a&&o&&r&&l,downloadResults:()=>{let e=document.createElement("a");e.href=m,e.target="_blank",e.rel="noopener noreferrer",e.click(),e.remove()},infoTooltip:j,isLoading:d,isDisabled:!h}},eI=e=>{let{privacyRequest:t}=e,{errorAlert:i,successAlert:n}=(0,Q.V)(),s=t.status===x.q2.ERROR,[a]=(0,X.Fq)();return{reprocessPrivacyRequest:async()=>{if(!t)return;let e=o.Pg3.loading("Reprocessing privacy request...",0),s=await a(t);"error"in s?i((0,em.e$)(s.error),"DSR automation has failed for this privacy request due to the following:",{duration:null}):n("Privacy request is now being reprocessed."),e()},showReprocess:s}},eO=e=>{let{privacyRequest:t}=e,{showDownloadResults:i,downloadResults:n,infoTooltip:s,isDisabled:a}=eP({privacyRequest:t}),{isModalOpen:l,closeModal:c,performAction:d,openConfirmationModal:u,showAction:p}=eN({privacyRequest:t,action:"approve"}),{isModalOpen:m,closeModal:x,performAction:g,openConfirmationModal:j,showAction:y}=eN({privacyRequest:t,action:"deny"}),{reprocessPrivacyRequest:v,showReprocess:f}=eI({privacyRequest:t}),_=(0,h.useMemo)(()=>{let e=[];return e.push({key:"approve",label:(0,r.jsx)("span",{"data-testid":"privacy-request-approve-btn",children:"Approve"}),onClick:u,disabled:!p}),e.push({key:"deny",label:(0,r.jsx)("span",{"data-testid":"privacy-request-deny-btn",children:"Deny"}),onClick:j,disabled:!y}),e.push({key:"reprocess",label:(0,r.jsx)("span",{"data-testid":"privacy-request-action-reprocess",children:"Reprocess"}),onClick:v,disabled:!f}),i&&e.push({key:"download",label:(0,r.jsx)(o.esZ,{title:a?s:null,placement:"bottom",children:(0,r.jsx)("span",{"data-testid":"download-results-btn",children:"Download request results"})}),onClick:n,disabled:a}),e},[i,n,s,a,p,y,u,j,f,v]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.S0p,{menu:{items:_},trigger:["click"],overlayStyle:{minWidth:"160px"},children:(0,r.jsx)(o.wpx,{icon:(0,r.jsx)(o.PJP.pO,{}),"data-testid":"privacy-request-actions-dropdown-btn",iconPosition:"end",type:"primary",disabled:!_.length,size:"large",children:"Actions"})}),(0,r.jsx)(eA.Z,{isOpen:l,isLoading:!1,onClose:c,onApproveRequest:()=>d({reason:""}),subjectRequest:t}),(0,r.jsx)(ek.Z,{isOpen:m,onClose:x,onDenyRequest:e=>g({reason:e})})]})},eD=()=>{let e=(0,c.useRouter)().query.id,{data:t,isLoading:i}=(0,m.QA)({id:e,verbose:!0},{skip:!e}),n=(null==t?void 0:t.items[0])||null;return(0,r.jsxs)(d.Z,{title:"Privacy Request - ".concat(e),children:[(0,r.jsx)(p.Z,{heading:"Privacy Requests",breadcrumbItems:[{title:"All requests",href:u.Jw},{title:"Request details"}],rightContent:!!n&&(0,r.jsx)(eO,{privacyRequest:n})}),i&&(0,r.jsx)(o.M5Y,{children:(0,r.jsx)(o.$jN,{})}),!i&&!n&&(0,r.jsx)(o.xvT,{children:"404 no privacy request found"}),!i&&n&&(0,r.jsx)(eE,{data:n})]})}},15709:function(e){e.exports={value:"RequestDetailsRow_value__WMXn3",label:"RequestDetailsRow_label__dn3CQ"}},38450:function(e){e.exports={container:"ActivityTimelineEntry_container__tCva0","container--open":"ActivityTimelineEntry_container--open__1d9mA",itemButton:"ActivityTimelineEntry_itemButton__MlmWS","itemButton--error":"ActivityTimelineEntry_itemButton--error__UizD2","itemButton--comment":"ActivityTimelineEntry_itemButton--comment__g98SH","itemButton--awaiting-input":"ActivityTimelineEntry_itemButton--awaiting-input__6lB5t",header:"ActivityTimelineEntry_header__GYibj",title:"ActivityTimelineEntry_title__rm_g0","title--error":"ActivityTimelineEntry_title--error__fOi0s","title--awaiting-input":"ActivityTimelineEntry_title--awaiting-input__3sPAo",timestamp:"ActivityTimelineEntry_timestamp__uMEMT",viewLogs:"ActivityTimelineEntry_viewLogs___T4jN",logs:"ActivityTimelineEntry_logs__T7R0J","logs--open":"ActivityTimelineEntry_logs--open__o_9Io"}}},function(e){e.O(0,[3988,2888,9774,179],function(){return e(e.s=6554)}),_N_E=e.O()}]);