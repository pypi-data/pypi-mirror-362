(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a1c64e18"],{4989:function(e,t,n){"use strict";var i=n("c7eb"),a=n("1da1"),r=(n("0fb7"),n("450d"),n("f529")),s=n.n(r);n("d3b7"),n("ff51");t["a"]={showTips:function(){window.pywebview.api.show_tips().then((function(e){s.a.info(e)}))},getNav:function(){return window.pywebview.api.get_nav()},getSysInfo:function(){return window.pywebview.api.get_sys_info()},initEnv:function(){return window.pywebview.api.init_env()},modelList:function(e,t,n){return window.pywebview.api.model_list({page:e,limit:t,search:n})},createModel:function(e){return window.pywebview.api.create_model(e)},searchModelFile:function(e){return window.pywebview.api.search_model_file(e)},openFileSelector:function(){return window.pywebview.api.open_file_select()},createDownload:function(e){return window.pywebview.api.create_download(e)},createBatchDownload:function(e){return window.pywebview.api.create_batch_download(e)},getDownloadFiles:function(e){return window.pywebview.api.get_download_files(e)},delFile:function(e){return window.pywebview.api.delete_file_download(e)},delModel:function(e){return window.pywebview.api.delete_model(e)},importFile:function(e){return window.pywebview.api.import_file(e)},fileList:function(e){return window.pywebview.api.file_list(e)},getModel:function(e){return window.pywebview.api.get_model(e)},runModel:function(e){return window.pywebview.api.run_model(e)},listRunningModel:function(e){return window.pywebview.api.list_running_model(e)},stopRunningModel:function(e){return window.pywebview.api.stop_running_model(e)},listRunningModeHistory:function(e){return window.pywebview.api.list_running_model_history(e)},delRunningModel:function(e){return window.pywebview.api.del_running_model(e)},showTk:function(){return window.pywebview.api.show_tk()},splitMergeGguf:function(e){return window.pywebview.api.split_merge_gguf(e)},listSplitMerge:function(e){return window.pywebview.api.list_split_merge(e)},listQuantize:function(e){return window.pywebview.api.list_quantize(e)},listQuantizeParams:function(){return window.pywebview.api.list_quantize_params()},quantize:function(e){return window.pywebview.api.quantize(e)},convertHfToGguf:function(e){return window.pywebview.api.convert_hf_to_gguf(e)},listConvertModel:function(e){return window.pywebview.api.list_covert_model(e)},getSetting:function(){return window.pywebview.api.get_setting()},saveSetting:function(e){return window.pywebview.api.save_setting(e)},getLlamaCppConfig:function(){return window.pywebview.api.get_llama_cpp_config()},saveLlamaCppConfig:function(e){return window.pywebview.api.save_llama_cpp_config(e)},getLLamaServerInfo:function(){return window.pywebview.api.get_llama_server_info()},startLLamaServer:function(){return window.pywebview.api.start_llama_server()},stopLLamaServer:function(){return window.pywebview.api.stop_llama_server()},openFileInSysEdit:function(e){return window.pywebview.api.open_file_in_sys_edit(e)},train:function(e){return Object(a["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){window.pywebview.api.train(e).then((function(e){t(e)})).catch((function(e){n(e)}))})));case 1:case"end":return t.stop()}}),t)})))()},getTrainList:function(e,t){return window.pywebview.api.get_train_list(e,t)},deleteTrainRecord:function(e){return window.pywebview.api.delete_train_record(e)},generateTrainCode:function(e){return window.pywebview.api.generate_train_code(e)},checkSshConnection:function(e,t,n,i){return window.pywebview.api.check_ssh_connection(e,t,n,i)},remoteTrain:function(e){return Object(a["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){window.pywebview.api.remote_train(e).then((function(e){t(e)})).catch((function(e){n(e)}))})));case 1:case"end":return t.stop()}}),t)})))()},getLlamaFactoryInfo:function(){return window.pywebview.api.get_llamafactory_info()},installLlamaFactory:function(){return window.pywebview.api.install_llamafactory()},installLlamafactoryManual:function(){return window.pywebview.api.install_llamafactory_manual()},reloadInstallState:function(){return window.pywebview.api.reload_install_state()},isTraining:function(){return window.pywebview.api.is_training()},stopTrain:function(){return window.pywebview.api.stop_train()},getAiChatUrl:function(){return window.pywebview.api.get_ai_chat_url()},startLlamafactory:function(){return window.pywebview.api.start_lf_webui()},stopLlamafactory:function(){return window.pywebview.api.stop_lf_webui()},isLlamafactoryRunning:function(){return window.pywebview.api.is_lf_running()},getRecentServerInfo:function(){return window.pywebview.api.get_recent_server_info()},getSdInfo:function(){return window.pywebview.api.get_sd_info()},initSd:function(){return window.pywebview.api.init_sd()},sdGeneratePic:function(e){return window.pywebview.api.sd_generate_pic(e)},saveImages:function(e){return window.pywebview.api.save_image(e)},sdPicToPic:function(e){return window.pywebview.api.sd_pic_to_pic(e)}}},"498a":function(e,t,n){"use strict";var i=n("23e7"),a=n("58a8").trim,r=n("c8d2");i({target:"String",proto:!0,forced:r("trim")},{trim:function(){return a(this)}})},5899:function(e,t,n){"use strict";e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,n){"use strict";var i=n("e330"),a=n("1d80"),r=n("577e"),s=n("5899"),o=i("".replace),c=RegExp("^["+s+"]+"),u=RegExp("(^|[^"+s+"])["+s+"]+$"),w=function(e){return function(t){var n=r(a(t));return 1&e&&(n=o(n,c,"")),2&e&&(n=o(n,u,"$1")),n}};e.exports={start:w(1),end:w(2),trim:w(3)}},"77fe":function(e,t,n){},9290:function(e,t,n){"use strict";n.r(t);n("b0c0");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"chat-container"},[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",[e._v("模型进程")]),t("el-breadcrumb-item",[e._v("AI chat")])],1),t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("AI聊天助手:    "),t("strong",[e._v(e._s(e.model.name))])]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){return e.$router.back()}}},[e._v("返回")])],1),t("div",{ref:"scrollableDiv",staticClass:"chat-messages"},[e._l(e.messages,(function(n,i){return t("div",{key:i,staticClass:"message-item"},["user"===n.role?t("div",{staticClass:"message-avatar"},[t("i",{staticClass:"el-icon-user"})]):t("div",{staticClass:"message-avatar"},[t("span",{staticClass:"icon iconfont"},[e._v("")])]),t("div",{staticClass:"message-content",class:n.role},[t("div",{staticClass:"message-bubble"},[t("pre",[e._v(e._s(n.content))])])])])})),e.isLoading?t("div",{staticClass:"message-item"},[t("div",{staticClass:"message-avatar"},[t("span",{staticClass:"icon iconfont"},[e._v("")])]),t("div",{staticClass:"message-content assistant"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"message-bubble",attrs:{"element-loading-text":"思考中..."}})])]):e._e()],2),t("div",[t("span",{staticStyle:{color:"#606266"}},[e._v("深度思考:")]),t("el-switch",{model:{value:e.think,callback:function(t){e.think=t},expression:"think"}})],1),t("div",{staticClass:"chat-input"},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入问题..."},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage.apply(null,arguments)}},model:{value:e.inputMessage,callback:function(t){e.inputMessage=t},expression:"inputMessage"}}),t("el-button",{attrs:{type:"primary",disabled:e.isLoading},on:{click:e.sendMessage}},[e._v("发送")])],1)])],1)},a=[],r=n("c7eb"),s=n("1da1"),o=(n("d9e2"),n("14d9"),n("e9c4"),n("b64b"),n("d3b7"),n("ac1f"),n("5319"),n("498a"),n("4989")),c=n("ff51"),u={name:"ChatWindow",data:function(){return{messages:[],inputMessage:"",isLoading:!1,apiKey:"",apiUrl:"http://127.0.0.1:5000/v1/chat/completions",modelId:"",modelName:"",modelType:"",reasoningArgs:"",model:{},memory:5,stream:!1,torch_dtype:"auto",think:!0}},created:function(){var e=this;if(this.getUrl(),this.modelId=this.$route.query.modelId,this.modelName=this.$route.query.modelName,this.modelType=this.$route.query.modelType,this.reasoningArgs=JSON.parse(this.$route.query.reasoningArgs),this.memory=this.reasoningArgs.memory,this.stream=this.reasoningArgs.stream,this.torch_dtype=this.reasoningArgs.torch_dtype,this.modelId){var t=Object(c["e"])("加载模型...");o["a"].getModel(this.modelId).then((function(n){Object(c["b"])(t),e.model=JSON.parse(n)})).catch((function(n){Object(c["b"])(t),e.$message.error(n)}))}},methods:{toEnd:function(){this.$refs.scrollableDiv&&this.$refs.scrollableDiv.scrollTo({top:this.$refs.scrollableDiv.scrollHeight,behavior:"smooth"})},sendMessage:function(){var e=this;return Object(s["a"])(Object(r["a"])().mark((function t(){var n,i;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.inputMessage.trim()){t.next=2;break}return t.abrupt("return");case 2:if(!0===e.think||(e.inputMessage+="/no_think"),n={role:"user",content:e.inputMessage},e.messages.length>=e.memory&&(e.messages.shift(),e.messages.shift()),e.messages.push(n),e.toEnd(),e.inputMessage="",t.prev=8,e.isLoading=!0,!e.stream){t.next=15;break}return t.next=13,e.callOpenAIAPIStream(e.messages,e.reasoningArgs);case 13:t.next=19;break;case 15:return t.next=17,e.callOpenAIAPI(e.messages,e.reasoningArgs);case 17:i=t.sent,e.messages.push(i);case 19:e.toEnd(),t.next=26;break;case 22:t.prev=22,t.t0=t["catch"](8),console.error("Error:",t.t0),e.messages.push({role:"assistant",content:"抱歉，请求出错: "+t.t0.message});case 26:return t.prev=26,e.isLoading=!1,t.finish(26);case 29:case"end":return t.stop()}}),t,null,[[8,22,26,29]])})))()},callOpenAIAPI:function(e,t){var n=this;return Object(s["a"])(Object(r["a"])().mark((function i(){var a,s;return Object(r["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,fetch(n.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.apiKey)},body:JSON.stringify(Object.assign({model:n.model.name,messages:e},t))});case 2:if(a=i.sent,a.ok){i.next=5;break}throw new Error("HTTP error! status: ".concat(a.status));case 5:return i.next=7,a.json();case 7:return s=i.sent,i.abrupt("return",{role:"assistant",content:s.choices[0].message.content});case 9:case"end":return i.stop()}}),i)})))()},callOpenAIAPIStream:function(e,t){var n=this;return Object(s["a"])(Object(r["a"])().mark((function i(){var a,s,o,c,u,w,l,p,d,f,g,v,b,m;return Object(r["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,fetch(n.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.apiKey)},body:JSON.stringify(Object.assign({model:n.model.name,messages:e},t))});case 2:a=i.sent,s=a.body.getReader(),o=new TextDecoder("utf-8"),c=0;case 6:return!0===n.isLoading&&(n.isLoading=!1),i.next=10,s.read();case 10:if(u=i.sent,w=u.done,l=u.value,!w){i.next=16;break}return console.log("流读取完成"),i.abrupt("break",27);case 16:p=o.decode(l),console.log("接收到数据块:",p),d=p.replace("data:","").trim(),f=JSON.parse(d),g=f.choices[0].delta.content,v=f.choices[0].delta.role,0===c?(b={role:v,content:""},n.messages.push(b)):g&&(m=n.messages[n.messages.length-1],m.content+=g),n.toEnd(),c++,i.next=6;break;case 27:case"end":return i.stop()}}),i)})))()},getUrl:function(){var e=this,t=this.$store.state.sysInfo.base_url;t?this.apiUrl=t+"/v1/chat/completions":o["a"].getAiChatUrl().then((function(t){e.apiUrl=t})).catch((function(t){e.$message.error(t)}))}}},w=u,l=(n("d24b"),n("2877")),p=Object(l["a"])(w,i,a,!1,null,"12b64966",null);t["default"]=p.exports},b64b:function(e,t,n){"use strict";var i=n("23e7"),a=n("7b0b"),r=n("df75"),s=n("d039"),o=s((function(){r(1)}));i({target:"Object",stat:!0,forced:o},{keys:function(e){return r(a(e))}})},c8d2:function(e,t,n){"use strict";var i=n("5e77").PROPER,a=n("d039"),r=n("5899"),s="​᠎";e.exports=function(e){return a((function(){return!!r[e]()||s[e]()!==s||i&&r[e].name!==e}))}},d24b:function(e,t,n){"use strict";n("77fe")}}]);
//# sourceMappingURL=chunk-a1c64e18.0e7dce36.js.map