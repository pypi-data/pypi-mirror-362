import{f as d}from"./main-DdMWAwpf.js";/*! @name videojs-playlist @version 5.2.0 @license Apache-2.0 */const m=t=>typeof t=="number"&&!isNaN(t)&&t>=0&&t<1/0;let g=t=>{const n=t.playlist.autoadvance_;n.timeout&&t.clearTimeout(n.timeout),n.trigger&&t.off("ended",n.trigger),n.abortOrErrorHandler&&t.off(["abort","error"],n.abortOrErrorHandler),n.timeout=null,n.trigger=null,n.abortOrErrorHandler=null};const I=(t,n)=>{if(g(t),!m(n)){t.playlist.autoadvance_.delay=null;return}t.playlist.autoadvance_.delay=n,t.playlist.autoadvance_.trigger=function(){const s=()=>I(t,n);t.one("play",s),t.playlist.autoadvance_.timeout=t.setTimeout(()=>{g(t),t.off("play",s),t.one("loadstart",function(){t.playlist.isAutoadvancing=!0}),t.playlist.next(!0)},n*1e3)},t.playlist.autoadvance_.abortOrErrorHandler=function(){t.playlist.isAutoadvancing=!1},t.one("ended",t.playlist.autoadvance_.trigger),t.one(["abort","error"],t.playlist.autoadvance_.abortOrErrorHandler)},_=t=>{const n=t.remoteTextTracks();let s=n&&n.length||0;for(;s--;)t.removeRemoteTextTrack(n[s])},y=(t,n,s=!1)=>{const i=!t.paused()||t.ended(),a=()=>{t.audioPosterMode()&&t.poster(n.poster||"")};return t.trigger("beforeplaylistitem",n.originalValue||n),n.playlistItemId_&&(t.playlist.currentPlaylistItemId_=n.playlistItemId_),t.poster(s?"":n.poster||""),t.off("audiopostermodechange",a),t.one("audiopostermodechange",a),t.src(n.sources),_(t),t.ready(()=>{if((n.textTracks||[]).forEach(t.addRemoteTextTrack.bind(t)),t.trigger("playlistitem",n.originalValue||n),i){const e=t.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,r=>{})}I(t,t.playlist.autoadvance_.delay)}),t};let x=1;const v=t=>{let n=t;return(!t||typeof t!="object")&&(n=Object(t),n.originalValue=t),n.playlistItemId_=x++,n},p=t=>t.map(v),b=(t,n)=>{for(let s=0;s<t.length;s++)if(t[s].playlistItemId_===n)return s;return-1},A=(t,n)=>{let s=t,i=n;return typeof t=="object"&&(s=t.src),typeof n=="object"&&(i=n.src),/^\/\//.test(s)&&(i=i.slice(i.indexOf("//"))),/^\/\//.test(i)&&(s=s.slice(s.indexOf("//"))),s===i},c=(t,n)=>{for(let s=0;s<t.length;s++){const i=t[s].sources;if(Array.isArray(i))for(let a=0;a<i.length;a++){const e=i[a];if(e&&A(e,n))return s}}return-1},P=t=>{let n=-1;const s=t.length-1;for(;++n<t.length;){const i=n+Math.floor(Math.random()*(s-n+1)),a=t[i];t[i]=t[n],t[n]=a}return t};function O(t,n,s=0){let i=null,a=!1;const e=t.playlist=(r,o=0)=>{if(a)throw new Error("do not call playlist() during a playlist change");if(Array.isArray(r)){const l=Array.isArray(i)?i.slice():null;i=p(r),a=!0,t.trigger({type:"duringplaylistchange",nextIndex:o,nextPlaylist:r,previousIndex:e.currentIndex_,previousPlaylist:l||[]}),a=!1,o!==-1&&e.currentItem(o),l&&t.setTimeout(()=>{t.trigger({type:"playlistchange",action:"change"})},0)}return i.map(l=>l.originalValue||l)};return t.on("loadstart",()=>{e.currentItem()===-1&&g(t)}),e.currentIndex_=-1,e.player_=t,e.autoadvance_={},e.repeat_=!1,e.currentPlaylistItemId_=null,e.currentItem=(r,o)=>{if(a)return e.currentIndex_;if(typeof r=="number"&&e.currentIndex_!==r&&r>=0&&r<i.length)return e.currentIndex_=r,y(e.player_,i[e.currentIndex_],o),e.currentIndex_;const l=e.player_.currentSrc()||"";if(e.currentPlaylistItemId_){const u=b(i,e.currentPlaylistItemId_),f=i[u];if(f&&Array.isArray(f.sources)&&c([f],l)>-1)return e.currentIndex_=u,e.currentIndex_;e.currentPlaylistItemId_=null}return e.currentIndex_=e.indexOf(l),e.currentIndex_},e.add=(r,o)=>{if(a)throw new Error("cannot modify a playlist that is currently changing");(typeof o!="number"||o<0||o>i.length)&&(o=i.length),Array.isArray(r)||(r=[r]),i.splice(o,0,...p(r)),t.trigger({type:"playlistchange",action:"add"}),t.trigger({type:"playlistadd",count:r.length,index:o})},e.remove=(r,o=1)=>{if(a)throw new Error("cannot modify a playlist that is currently changing");typeof r!="number"||r<0||r>i.length||(i.splice(r,o),t.trigger({type:"playlistchange",action:"remove"}),t.trigger({type:"playlistremove",count:o,index:r}))},e.contains=r=>e.indexOf(r)!==-1,e.indexOf=r=>{if(typeof r=="string")return c(i,r);const o=Array.isArray(r)?r:r.sources;for(let l=0;l<o.length;l++){const u=o[l];if(typeof u=="string")return c(i,u);if(u.src)return c(i,u.src)}return-1},e.currentIndex=()=>e.currentItem(),e.lastIndex=()=>i.length-1,e.nextIndex=()=>{const r=e.currentItem();if(r===-1)return-1;const o=e.lastIndex();return e.repeat_&&r===o?0:Math.min(r+1,o)},e.previousIndex=()=>{const r=e.currentItem();return r===-1?-1:e.repeat_&&r===0?e.lastIndex():Math.max(r-1,0)},e.first=()=>{if(a)return;const r=e.currentItem(0);if(i.length)return i[r].originalValue||i[r];e.currentIndex_=-1},e.last=()=>{if(a)return;const r=e.currentItem(e.lastIndex());if(i.length)return i[r].originalValue||i[r];e.currentIndex_=-1},e.next=(r=!1)=>{if(a)return;const o=e.nextIndex();if(o!==e.currentIndex_){const l=e.currentItem(o,r);return i[l].originalValue||i[l]}},e.previous=()=>{if(a)return;const r=e.previousIndex();if(r!==e.currentIndex_){const o=e.currentItem(r);return i[o].originalValue||i[o]}},e.autoadvance=r=>{I(e.player_,r)},e.repeat=r=>{if(r===void 0)return e.repeat_;if(typeof r!="boolean"){d.log.error("videojs-playlist: Invalid value for repeat",r);return}return e.repeat_=!!r,e.repeat_},e.sort=r=>{i.length&&(i.sort(r),!a&&t.trigger("playlistsorted"))},e.reverse=()=>{i.length&&(i.reverse(),!a&&t.trigger("playlistsorted"))},e.shuffle=({rest:r}={})=>{let o=0,l=i;r&&(o=e.currentIndex_+1,l=i.slice(o)),!(l.length<=1)&&(P(l),r&&i.splice(...[o,l.length].concat(l)),!a&&t.trigger("playlistsorted"))},Array.isArray(n)?e(n,s):i=[],e}var E="5.2.0";const T=d.registerPlugin||d.plugin,h=function(t,n){O(this,t,n)};T("playlist",h);h.VERSION=E;export{h as default};
