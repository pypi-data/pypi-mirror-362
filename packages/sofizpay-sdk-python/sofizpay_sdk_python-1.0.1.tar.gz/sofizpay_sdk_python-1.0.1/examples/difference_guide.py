"""
ููู ุชูุถูุญู ูููุฑู ุจูู Transaction Streaming ู Get Transaction
"""

import asyncio
from datetime import datetime
from sofizpay import SofizPayClient


def explain_difference():
    """ุดุฑุญ ุงููุฑู ุจูู ุงููุธููุชูู"""
    
    print("๐ ุงููุฑู ุจูู Transaction Streaming ู Get Transaction")
    print("=" * 70)
    
    print("\n๐ GET TRANSACTION BY HASH:")
    print("-" * 40)
    print("โ ูุจุญุซ ุนู ูุนุงููุงุช ุญุฏุซุช ุจุงููุนู ูู ุงููุงุถู")
    print("โ ุชุญุชุงุฌ hash ูุนุงููุฉ ููุฌูุฏุฉ")
    print("โ ูุนุทู ุชูุงุตูู ูุงููุฉ ูููุนุงููุฉ")
    print("โ ุจุญุซ ุณุฑูุน ููุชูุฌุฉ ููุฑูุฉ")
    print("โ ูุง ูุฑุงูุจ ูุนุงููุงุช ุฌุฏูุฏุฉ")
    print("\n๐ก TRANSACTION STREAMING:")
    print("-" * 40)
    print("โ ูุฑุงูุจ ุงููุนุงููุงุช ุงูุฌุฏูุฏุฉ ูู ุงูููุช ุงููุนูู")
    print("โ ููุชูุท ููุท ุงููุนุงููุงุช ุงูุชู ุชุญุฏุซ ุจุนุฏ ุจุฏุก ุงููุฑุงูุจุฉ")
    print("โ ูุฑุงูุจุฉ ูุณุชูุฑุฉ ููุจุงุดุฑุฉ")
    print("โ ูุนูู ูุน ูุนุงููุงุช ูุณุชูุจููุฉ")
    print("โ ูุง ูุนุฑุถ ูุนุงููุงุช ูู ุงููุงุถู")
    
    print("\n๐ก ูุชู ูุณุชุฎุฏู ูู ูุธููุฉ:")
    print("-" * 40)
    print("๐ ุงุณุชุฎุฏู get_transaction_by_hash ุนูุฏูุง:")
    print("   โข ุชุฑูุฏ ูุนูููุงุช ุนู ูุนุงููุฉ ูุญุฏุฏุฉ ุญุฏุซุช")
    print("   โข ูุฏูู hash ูุนุงููุฉ ูุชุฑูุฏ ุชูุงุตูููุง")
    print("   โข ุชุฑูุฏ ุงูุชุญูู ูู ุญุงูุฉ ูุนุงููุฉ ุฃุฑุณูุชูุง")
    
    print("\n๐ก ุงุณุชุฎุฏู transaction_streaming ุนูุฏูุง:")
    print("   โข ุชุฑูุฏ ูุฑุงูุจุฉ ุญุณุงุจ ูููุนุงููุงุช ุงูุฌุฏูุฏุฉ")
    print("   โข ุชุจูู ุชุทุจูู ูุญุชุงุฌ ุชูุจููุงุช ููุฑูุฉ")
    print("   โข ุชุฑูุฏ ูุนุฑูุฉ ููุฑ ูุตูู ูุนุงููุฉ ุฌุฏูุฏุฉ")


async def demo_get_transaction():
    """ุนุฑุถ ุชูุถูุญู ูู get_transaction"""
    
    print("\n" + "=" * 70)
    print("๐ ุนุฑุถ ุชูุถูุญู: GET TRANSACTION BY HASH")
    print("=" * 70)
    
    client = SofizPayClient()
    
    # ูุซุงู ุนูู hash (ุบูุฑ ุญูููู)
    demo_hash = "example_hash_from_past_transaction"
    
    print(f"๐ ุงูุจุญุซ ุนู ูุนุงููุฉ ุจู hash: {demo_hash}")
    print("๐ญ ูุฐุง hash ููุนุงููุฉ 'ุญุฏุซุช ูู ุงููุงุถู'")
    print("โฐ ุงูุขู ูุจุญุซ ุนููุง ูู ุณุฌูุงุช ุงูุดุจูุฉ...")
    
    try:
        result = await client.get_transaction_by_hash(demo_hash)
        
        if result['found']:
            print("โ ุชู ุงูุนุซูุฑ ุนูู ุงููุนุงููุฉ ุงููุฏููุฉ!")
        else:
            print("โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงููุนุงููุฉ (hash ุบูุฑ ุตุญูุญ)")
            print("๐ก ููุญุตูู ุนูู ูุชูุฌุฉ: ุงุณุชุฎุฏู hash ูุนุงููุฉ ุญููููุฉ")
            
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุงูุจุญุซ: {e}")


async def demo_transaction_streaming():
    """ุนุฑุถ ุชูุถูุญู ูู transaction streaming"""
    
    print("\n" + "=" * 70)
    print("๐ก ุนุฑุถ ุชูุถูุญู: TRANSACTION STREAMING")
    print("=" * 70)
    
    client = SofizPayClient()
    
    # ุญุณุงุจ ูููุฑุงูุจุฉ (ูุซุงู)
    demo_account = "GDNS27ISCGOIJFXC6CM4O5SVHVJPSWR42QEBWUFF24N5VVHGW73ZSJNQ"
    
    print(f"๐ก ุจุฏุก ูุฑุงูุจุฉ ุงูุญุณุงุจ: {demo_account[:20]}...")
    print(f"โฐ ููุช ุจุฏุก ุงููุฑุงูุจุฉ: {datetime.now().strftime('%H:%M:%S')}")
    print("๐ญ ุงูุขู ููุชุธุฑ ูุนุงููุงุช ุฌุฏูุฏุฉ ููุท...")
    print("๐ ุฅุฐุง ุญุฏุซุช ูุนุงููุฉ ุจุนุฏ ูุฐุง ุงูููุชุ ุณุชุธูุฑ ููุง!")
    
    # ูุนุงูุฌ ูููุนุงููุงุช
    def demo_handler(transaction):
        print(f"\n๐ ูุนุงููุฉ ุฌุฏูุฏุฉ ูุตูุช!")
        print(f"โฐ ููุช ุงููุตูู: {datetime.now().strftime('%H:%M:%S')}")
        print(f"๐ฐ ุงููุจูุบ: {transaction.get('amount', 'ุบูุฑ ูุนุฑูู')}")
        print("๐ฅ ูุฐู ูุนุงููุฉ ุทุงุฒุฌุฉ - ุญุฏุซุช ููุชู!")
    
    try:
        # ุฅุนุฏุงุฏ ุงููุฑุงูุจุฉ
        stream_id = await client.setup_transaction_stream(
            public_key=demo_account,
            transaction_callback=demo_handler
        )
        
        print(f"โ ุชู ุฅุนุฏุงุฏ ุงููุฑุงูุจุฉ - Stream ID: {stream_id}")
        print("โณ ูุฑุงูุจุฉ ููุฏุฉ 10 ุซูุงูู...")
        print("๐ก ุฃุฑุณู ูุนุงููุฉ ุฅูู ุงูุญุณุงุจ ุงูุขู ูุฑุคูุฉ ุงููุชูุฌุฉ!")
        
        # ุงูุชุธุงุฑ ููุฏุฉ 10 ุซูุงูู
        await asyncio.sleep(10)
        
        # ุฅููุงู ุงููุฑุงูุจุฉ
        client.stop_transaction_stream(stream_id)
        print("\nโน๏ธ ุชู ุฅููุงู ุงููุฑุงูุจุฉ")
        print("๐ ุฅุฐุง ูู ุชุธูุฑ ูุนุงููุงุชุ ููู ุชุญุฏุซ ูุนุงููุงุช ุฌุฏูุฏุฉ")
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุงููุฑุงูุจุฉ: {e}")


async def compare_both_methods():
    """ููุงุฑูุฉ ุจูู ุงูุทุฑููุชูู"""
    
    print("\n" + "=" * 70)
    print("โ๏ธ ููุงุฑูุฉ ูุจุงุดุฑุฉ ุจูู ุงูุทุฑููุชูู")
    print("=" * 70)
    
    print("๐ ุฎุตุงุฆุต ูู ุทุฑููุฉ:")
    print("-" * 40)
    
    comparison = [
        ("ุงููุนุงููุงุช ุงููุณุชูุฏูุฉ", "ูุนุงููุงุช ูู ุงููุงุถู", "ูุนุงููุงุช ุฌุฏูุฏุฉ ููุท"),
        ("ุงูุณุฑุนุฉ", "ุณุฑูุน ุฌุฏุงู", "ูุฑุงูุจุฉ ูุณุชูุฑุฉ"), 
        ("ุงูุงุณุชุฎุฏุงู", "ุจุญุซ ููุฑุฉ ูุงุญุฏุฉ", "ูุฑุงูุจุฉ ูุณุชูุฑุฉ"),
        ("ุงููุฏุฎูุงุช ุงููุทููุจุฉ", "Transaction Hash", "Public Key ููุท"),
        ("ุงููุชุงุฆุฌ", "ุชูุงุตูู ูุงููุฉ", "ุชูุจููุงุช ููุฑูุฉ"),
        ("ุงุณุชููุงู ุงูููุงุฑุฏ", "ูููู", "ูุชูุณุท"),
    ]
    
    print(f"{'ุงูุฎุงุตูุฉ':<20} {'Get Transaction':<20} {'Streaming':<20}")
    print("-" * 60)
    
    for feature, get_tx, streaming in comparison:
        print(f"{feature:<20} {get_tx:<20} {streaming:<20}")
    
    print("\n๐ฏ ุงูุฎูุงุตุฉ:")
    print("-" * 15)
    print("โข ุงุณุชุฎุฏู get_transaction ููุจุญุซ ุนู ูุนุงููุงุช ููุฌูุฏุฉ")
    print("โข ุงุณุชุฎุฏู streaming ููุฑุงูุจุฉ ูุนุงููุงุช ุฌุฏูุฏุฉ")
    print("โข ูููู ุงุณุชุฎุฏุงู ุงูุงุซููู ูุนุงู ูู ุชุทุจูู ูุงุญุฏ!")


if __name__ == "__main__":
    print("๐ ุฏููู ุงููุฑููุงุช ุจูู Transaction Methods")
    print("=" * 70)
    
    try:
        # ุดุฑุญ ุงููุฑููุงุช
        explain_difference()
        
        # ุนุฑูุถ ุชูุถูุญูุฉ
        asyncio.run(demo_get_transaction())
        asyncio.run(demo_transaction_streaming())
        
        # ููุงุฑูุฉ
        asyncio.run(compare_both_methods())
        
        print("\nโ ุงูุชูู ุงูุฏููู ุงูุชูุถูุญู")
        print("๐ก ุงูุขู ููููู ุงุณุชุฎุฏุงู ุงูููููู ุงูุขุฎุฑูู ููุงุฎุชุจุงุฑ ุงูุนููู")
        
    except KeyboardInterrupt:
        print("\n๐ ุชู ุฅููุงู ุงูุนุฑุถ ุงูุชูุถูุญู")
    except Exception as e:
        print(f"\nโ ุฎุทุฃ: {e}")
