(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1263],{37412:(e,t,s)=>{Promise.resolve().then(s.bind(s,43407)),Promise.resolve().then(s.bind(s,23309))},43407:(e,t,s)=>{"use strict";s.d(t,{Dataloader:()=>U});var a=s(42227),r=s(49139),l=s(33636),n=s(70316),i=s(32982),c=s(46326),d=s(63808),o=s(1191),u=s(27908),h=s(28380),g=s(76270),f=s(73175),x=s(61528),m=s(11201),p=s(42031),j=s(29061),v=s(3901),b=s(50293),S=s(21680),N=s(84857),k=s(40947);async function y(e,t){return String(await (0,j.l)().use(v.A).use(b.A).use(N.A,{theme:"github-light",keepBackground:!1,transformers:[(0,k.F)({visibility:"always",feedbackDuration:3e3})]}).use(S.A).process("```"+(t||"")+"\n"+e.trimStart()+"\n```"))}function C(e){let{code:t,language:s,className:l}=e,[n,i]=(0,r.useState)(null);return(0,r.useEffect)(()=>{y(t,s).then(i)},[t,s]),(0,a.jsx)("section",{className:l||"",dangerouslySetInnerHTML:{__html:n||""}})}var w=s(3949),_=s(70709),A=s(64825),z=s(75571),F=s(87686),J=s(48981),O=s(28527),E=s(94618);let L={int:"number",float:"number",str:"text",bool:"checkbox",list:"text"},T=(e,t)=>{if("bool"===e)return"True"===t;if("int"===e)return parseInt(t);if("float"===e)return parseFloat(t);if("str"===e)return t;if("list"===e)return t.split(",");else if("dict"!==e)return t;else try{return JSON.parse(t)}catch(e){return{}}},I=(e,t)=>{if("bool"===e||"int"===e)return t;if("float"===e)return t;if("str"===e)return'"'.concat(t,'"');if("list"===e)return"[".concat(t.split(",").map(e=>'"'.concat(e,'"')).join(", "),"]");else if("dict"===e)return t;else return t},M=e=>e.map(e=>({label:e.name,value:e.name,selected:!1})),P=e=>e.args.reduce((e,t)=>{let[s,a]=t;return e[s]={type:a,value:""},e},{}),$=e=>e.reduce((e,t)=>(e[t.name]=P(t),e),{}),R=e=>Object.values(e).some(e=>{let{value:t}=e;return""!==t}),B=e=>{if("bool"===e)return"";if("int"===e)return"1";if("float"===e)return"1.0";if("str"===e)return"text";if("list"===e)return"abc, def, ...";else if("dict"===e)return'{"k": "v", ...} (JSON)';else return""};function D(e){let{spec:t,argsState:s,onArgsStateChange:r}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-[1fr_3fr] items-center gap-4",children:[(0,a.jsx)(F.E,{variant:"outline",children:t.name}),(0,a.jsx)("div",{children:t.args.map(e=>{var l,n;let[i,c]=e;return(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsxs)(A.J,{htmlFor:"name",className:"text-right text-xs font-mono",children:[i,": ",c]}),(0,a.jsx)(z.p,{className:"col-span-3 ".concat("bool"===c?"h-6 my-2":""),type:L[c],value:(null===(n=s[t.name])||void 0===n?void 0:null===(l=n[i])||void 0===l?void 0:l.value)||"",placeholder:B(c),onChange:e=>r(s=>({...s,[t.name]:{...s[t.name],[i]:{type:c,value:"bool"===c?e.target.checked?"True":"False":e.target.value}}}))})]},i)})})]}),t.args.length>0&&(0,a.jsx)("div",{className:"w-full flex justify-end",children:(0,a.jsxs)(_.$,{variant:"destructive",size:"sm",onClick:()=>r(e=>({...e,[t.name]:P(t)})),children:[(0,a.jsx)(l.A,{className:"h-4 w-4"}),"Reset"]})})]},t.name)}function W(e){let{icon:t,label:s,specs:l,selected:n,setSelected:i,argsState:c,onArgsStateChange:d,singleSelect:o=!1}=e,[u,h]=(0,r.useState)(!1);return(0,a.jsxs)(w.lG,{open:u,onOpenChange:h,children:[(0,a.jsx)(w.zM,{asChild:!0,children:(0,a.jsxs)(_.$,{variant:"outline",children:[t,s]})}),(0,a.jsxs)(w.Cf,{children:[(0,a.jsx)(w.L3,{children:s}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(m.K,{className:"col-span-3",value:n,onChange:i,label:s,singleSelect:o}),n.filter(e=>{let{selected:t}=e;return t}).map(e=>{let{value:t}=e;return l.find(e=>e.name===t)}).map(e=>e&&(0,a.jsx)(D,{spec:e,argsState:c,onArgsStateChange:d},e.name)),(0,a.jsx)(w.Es,{className:"justify-end",children:(0,a.jsx)(_.$,{onClick:()=>h(!1),children:"Save"})})]})]})]})}let Z=e=>Object.entries(e).filter(e=>{let[t,{value:s}]=e;return""!==s}).reduce((e,t)=>{let[s,{value:a,type:r}]=t;return e[s]=T(r,a),e},{}),G=(e,t)=>e.filter(e=>{let{selected:t}=e;return t}).map(e=>{let{value:s}=e;return{name:s,params:Z(t[s])}}),H=e=>R(e)?Object.entries(e).filter(e=>{let[t,{value:s}]=e;return""!==s}).map(e=>{let[t,{value:s,type:a}]=e;return'"'.concat(t,'": ').concat(I(a,s))}).join(", "):"",K=(e,t)=>e.filter(e=>{let{selected:t}=e;return t}).map(e=>{let{value:s}=e,a=H(t[s]);return a?'("'.concat(s,'", {').concat(a,"})"):'"'.concat(s,'"')});function U(e){let{apiUrl:t,apiKey:s,shardsetOptions:l,filters:j,categorizers:v,collaters:b,preprocessors:S}=e,{dataset_id:N}=(0,f.useParams)(),[k,y]=(0,r.useState)([]),[F,L]=(0,r.useState)({}),[T,I]=(0,r.useState)([]),[P,R]=(0,r.useState)({}),[B,D]=(0,r.useState)([]),[Z,H]=(0,r.useState)({}),[U,V]=(0,r.useState)([]),[q,Q]=(0,r.useState)({}),[X,Y]=(0,r.useState)([]),[ee,et]=(0,r.useState)(0),[es,ea]=(0,r.useState)(!1),[er,el]=(0,r.useState)(!1),[en,ei]=(0,r.useState)(0),[ec,ed]=(0,r.useState)(5),[eo,eu]=(0,r.useState)(0),[eh,eg]=(0,r.useState)(!1),[ef,ex]=(0,r.useState)([]),[em,ep]=(0,r.useState)([]),[ej,ev]=(0,r.useState)(!1),[eb,eS]=(0,r.useState)(null);(0,r.useEffect)(()=>{Y(l),y(M(j)),L($(j)),I(M(v)),R($(v)),V(M(b)),Q($(b)),D(M(S)),H($(S))},[l,j,v,b,S]);let eN=(0,r.useMemo)(()=>{let e={};X.filter(e=>e.selected).length>0&&(e.shardsets=X.filter(e=>e.selected).map(e=>e.value));let t=k.filter(e=>e.selected);t.length>0&&(e.filters=G(t,F));let s=T.filter(e=>e.selected);s.length>0&&(e.categorizer=G(s,P)[0]);let a=U.filter(e=>e.selected);a.length>0&&(e.collater=G(a,q)[0]);let r=B.filter(e=>e.selected);return r.length>0&&(e.preprocessors=G(r,Z)),ee>0&&(e.max_retry_count="".concat(ee)),es&&(e.skip_on_failure=es?"True":"False"),er&&(e.shuffle=er?"True":"False",e.shuffle_block_size="".concat(ec)),en&&(e.shuffle_seed="".concat(en)),eo&&(e.batch_size="".concat(eo)),eh&&(e.no_cache=eh?"True":"False"),e},[X,k,F,T,P,U,q,B,Z,ee,es,er,en,ec,eo,eh]),ek=(0,r.useMemo)(()=>{let e={};X.filter(e=>e.selected).length>0&&(e.shardsets="["+X.filter(e=>e.selected).map(e=>'"'.concat(e.value,'"')).join(", ")+"]");let t=k.filter(e=>e.selected);t.length>0&&(e.filters="["+K(t,F).join(", ")+"]");let s=T.filter(e=>e.selected);s.length>0&&(e.categorizer=K(s,P)[0]);let a=U.filter(e=>e.selected);a.length>0&&(e.collater=K(a,q)[0]);let r=B.filter(e=>e.selected);return r.length>0&&(e.preprocessors="["+K(r,Z).join(", ")+"]"),ee>0&&(e.max_retry_count="".concat(ee)),es&&(e.skip_on_failure=es?"True":"False"),er&&(e.shuffle=er?"True":"False",e.shuffle_block_size="".concat(ec)),en&&(e.shuffle_seed="".concat(en)),eo&&(e.batch_size="".concat(eo)),eh&&(e.no_cache=eh?"True":"False"),Object.entries(e).map(e=>{let[t,s]=e;return"\n    ".concat(t,"=").concat(s,",")}).join("")},[X,k,F,T,P,U,q,B,Z,ee,es,er,en,ec,eo,eh]),ey=(0,r.useCallback)(async()=>{ev(!0),ex([]),ep([]);try{let e=await (0,x.wH)(N,eN);eS(e.id),eC(e.id)}catch(e){O.oR.error(e instanceof Error?e.message:"Unknown error"),ev(!1)}},[eN]),eC=(0,r.useCallback)(async e=>{ev(!0),await Promise.all(Array.from({length:10}).map(async()=>{try{let t=await (0,x.LZ)(e);Object.keys(t).forEach(e=>{e.startsWith("_lavender_data_")&&delete t[e]}),ep(Object.keys(t).sort()),ex(e=>[...e,t])}catch(e){O.oR.error(e instanceof Error?e.message:"Unknown error")}})),ev(!1)},[]);return(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)(p.Zp,{className:"w-full",children:[(0,a.jsxs)(p.Wu,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 max-w-[640px] mb-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,a.jsx)(A.J,{children:"Shardsets"}),(0,a.jsx)(m.K,{value:X,onChange:Y,label:"Select shardsets",className:"col-span-3 w-full"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,a.jsx)(A.J,{children:"Pipelines"}),(0,a.jsxs)("div",{className:"flex gap-2 col-span-3",children:[(0,a.jsx)(W,{icon:(0,a.jsx)(n.A,{className:"h-4 w-4"}),label:"Filters",specs:j,selected:k,setSelected:y,argsState:F,onArgsStateChange:L}),(0,a.jsx)(W,{icon:(0,a.jsx)(i.A,{className:"h-4 w-4"}),label:"Categorizer",specs:v,selected:T,setSelected:I,argsState:P,onArgsStateChange:R,singleSelect:!0}),(0,a.jsx)(W,{icon:(0,a.jsx)(c.A,{className:"h-4 w-4"}),label:"Collater",specs:b,selected:U,setSelected:V,argsState:q,onArgsStateChange:Q,singleSelect:!0}),(0,a.jsx)(W,{icon:(0,a.jsx)(d.A,{className:"h-4 w-4"}),label:"Preprocessors",specs:S,selected:B,setSelected:D,argsState:Z,onArgsStateChange:H})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,a.jsx)(A.J,{children:"Shuffle"}),(0,a.jsxs)("div",{className:"col-span-3 w-full flex items-center gap-4",children:[(0,a.jsx)(J.d,{checked:er,onCheckedChange:el}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(A.J,{htmlFor:"shuffle-block-size",className:"text-right ".concat(er?"":"text-muted-foreground"),children:"Block Size"}),(0,a.jsx)(z.p,{id:"shuffle-block-size",type:"number",value:ec,onChange:e=>ed(parseInt(e.target.value)||0),min:1,disabled:!er})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(A.J,{htmlFor:"shuffle-seed",className:"text-right ".concat(er?"":"text-muted-foreground"),children:"Seed"}),(0,a.jsx)(z.p,{id:"shuffle-seed",type:"number",value:en,onChange:e=>ei(parseInt(e.target.value)||0),disabled:!er})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,a.jsx)(A.J,{children:"Settings"}),(0,a.jsx)("div",{className:"col-span-3",children:(0,a.jsxs)(w.lG,{children:[(0,a.jsx)(w.zM,{asChild:!0,children:(0,a.jsxs)(_.$,{variant:"outline",children:[(0,a.jsx)(o.A,{className:"h-4 w-4"}),"Settings"]})}),(0,a.jsxs)(w.Cf,{children:[(0,a.jsx)(w.L3,{children:"Settings"}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,a.jsx)(A.J,{children:"Batch Size"}),(0,a.jsx)(z.p,{min:0,type:"number",value:eo,onChange:e=>eu(parseInt(e.target.value)||0)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,a.jsx)(A.J,{children:"Max Retry Count"}),(0,a.jsx)(z.p,{min:0,type:"number",value:ee,onChange:e=>et(parseInt(e.target.value)||0)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,a.jsx)(A.J,{children:"Skip On Failure"}),(0,a.jsx)(J.d,{checked:es,onCheckedChange:ea})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,a.jsx)(A.J,{children:"No Cache"}),(0,a.jsx)(J.d,{checked:eh,onCheckedChange:eg})]})]})]})})]})]}),(0,a.jsx)(C,{className:"text-sm",language:"python",code:'\nimport lavender_data.client as lavender\n\nlavender.init(\n    api_url="'.concat(t,'",').concat(s?'\n    api_key="'.concat(s,'",'):"",'\n)\n\ndataloader = lavender.LavenderDataLoader(\n    "').concat(N,'",').concat(ek,"\n)")})]}),(0,a.jsx)(p.wL,{children:(0,a.jsxs)(_.$,{onClick:ey,disabled:ej,children:[ej?(0,a.jsx)(u.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(h.A,{className:"h-4 w-4"}),"Start Iteration"]})})]}),(0,a.jsxs)(p.Zp,{children:[(0,a.jsx)(p.Wu,{children:(0,a.jsx)(E.A,{datasetId:N,samples:ef,fetchedColumns:em})}),(0,a.jsx)(p.wL,{children:ef.length>0&&(0,a.jsxs)(_.$,{onClick:()=>eb&&eC(eb),disabled:ej,children:[ej?(0,a.jsx)(u.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(g.A,{className:"h-4 w-4"}),"Load More"]})})]})]})}},64825:(e,t,s)=>{"use strict";s.d(t,{J:()=>n});var a=s(42227);s(49139);var r=s(3175),l=s(27058);function n(e){let{className:t,...s}=e;return(0,a.jsx)(r.b,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}},87686:(e,t,s)=>{"use strict";s.d(t,{E:()=>c});var a=s(42227);s(49139);var r=s(8550),l=s(63152),n=s(27058);let i=(0,l.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/70",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:s,asChild:l=!1,...c}=e,d=l?r.Slot:"span";return(0,a.jsx)(d,{"data-slot":"badge",className:(0,n.cn)(i({variant:s}),t),...c})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5731,4452,1701,3228,4006,8527,543,5492,3031,5674,4618,813,5236,7358],()=>t(37412)),_N_E=e.O()}]);