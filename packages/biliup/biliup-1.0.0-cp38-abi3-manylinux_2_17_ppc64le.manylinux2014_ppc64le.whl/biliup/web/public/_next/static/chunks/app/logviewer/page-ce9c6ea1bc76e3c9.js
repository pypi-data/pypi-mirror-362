(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30],{9435:function(e,t,l){Promise.resolve().then(l.bind(l,49209))},49209:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return h}});var o=l(57437),n=l(2265),r=l(76301),s=l(70787);let a=(0,l(87565).A)(function(e){return n.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 4v16c0 1.1.9 2 2 2h16a2 2 0 0 0 2-2V8.41a1 1 0 0 0-.3-.7l-5.4-5.42a1 1 0 0 0-.71-.29H4a2 2 0 0 0-2 2Zm8 0v3h2V4h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h3ZM7 19a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H7Z",fill:"currentColor"}))},"save");var i=l(79901),c=l(41421);let d=e=>{let{logs:t,logContainerRef:l,isLoading:s}=e;if(s)return(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,o.jsx)(r.yC,{size:"large"})});let a=()=>{let e=document.getElementsByClassName("log-container");if(0===e.length)return!1;let t=e[0];return t.scrollHeight-t.scrollTop-t.clientHeight<=50},i=()=>{let e=document.getElementsByClassName("log-container");if(e.length>0){let t=e[0];t.scrollTop=t.scrollHeight}};return(0,n.useEffect)(()=>{t.length>0&&a()&&(console.log("自动滚动到底部"),i())},[t]),(0,o.jsx)("div",{className:"log-container",ref:l,style:{height:"calc(100% - 40px)",maxHeight:"calc(100vh - 180px)",overflow:"auto",padding:12,backgroundColor:"var(--semi-color-bg-1)",borderRadius:4,whiteSpace:"pre-wrap",wordBreak:"break-all"},children:t.length>0?t.map((e,t)=>(0,o.jsx)("div",{style:{marginBottom:2},children:e},t)):(0,o.jsx)("div",{style:{color:"var(--semi-color-text-2)",textAlign:"center",marginTop:20},children:"暂无日志内容"})})};function h(){let{Header:e,Content:t}=r.Layout,[l,h]=(0,n.useState)([]),[g,u]=(0,n.useState)(!1),[m,x]=(0,n.useState)(!0),[f,p]=(0,n.useState)("ds_update"),v=(0,n.useRef)(null),b=(0,n.useRef)(null),y=()=>{x(!0),h([]),v.current&&v.current.close();let e="https:"===window.location.protocol?"wss:":"ws:",t="".concat(e,"//").concat(window.location.host),l=new WebSocket("".concat(t,"/v1/ws/logs?file=").concat(f,".log"));v.current=l,l.onopen=()=>{u(!0),x(!1),r.FN.success("日志连接已建立")},l.onmessage=e=>{h(t=>[...t,e.data])},l.onerror=e=>{console.error("WebSocket错误:",e),l.readyState===WebSocket.CLOSED||l.readyState===WebSocket.CLOSING?console.log("WebSocket在连接建立前已关闭"):r.FN.error("连接错误，请重试"),x(!1)},l.onclose=()=>{u(!1),console.log("WebSocket连接已关闭")}};return(0,n.useEffect)(()=>(y(),()=>{v.current&&(console.log("主动关闭WebSocket连接"),v.current.close())}),[f]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e,{style:{backgroundColor:"var(--semi-color-bg-1)"},children:(0,o.jsx)(r.JL,{style:{border:"none"},header:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{style:{backgroundColor:"rgba(var(--semi-blue-4), 1)",borderRadius:"var(--semi-border-radius-large)",color:"var(--semi-color-bg-0)",display:"flex",padding:"6px"},children:(0,o.jsx)(s.Z,{size:"large"})}),(0,o.jsx)("h4",{style:{marginLeft:"12px"},children:"实时日志"})]}),mode:"horizontal"})}),(0,o.jsx)(t,{style:{padding:12,backgroundColor:"var(--semi-color-bg-0)",height:"calc(100vh - 60px)",display:"flex",flexDirection:"column"},children:(0,o.jsx)(r.Card,{style:{flex:1,overflow:"hidden"},bodyStyle:{height:"100%",overflow:"hidden",boxSizing:"border-box"},children:(0,o.jsxs)(r.mQ,{type:"line",style:{marginTop:-20,marginBottom:-20},activeKey:f,onChange:e=>{p(e)},tabBarExtraContent:(0,o.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,o.jsx)(r.zx,{icon:(0,o.jsx)(a,{}),onClick:()=>window.location.href="/static/".concat(f,".log"),type:"primary",theme:"solid",size:"small",children:"下载"}),(0,o.jsx)(r.zx,{icon:(0,o.jsx)(i.Z,{}),onClick:()=>{y()},theme:"light",size:"small",children:"刷新"}),(0,o.jsx)(r.zx,{icon:(0,o.jsx)(c.Z,{}),onClick:()=>{h([])},theme:"light",size:"small",children:"清空"}),(0,o.jsx)(r.Typography.Text,{type:g?"success":"danger",style:{marginLeft:8,display:"flex",alignItems:"center"},children:g?"已连接":"未连接"})]}),children:[(0,o.jsx)(r.Jm,{tab:"主程序运行日志",itemKey:"ds_update",children:(0,o.jsx)(d,{logs:l,logContainerRef:b,isLoading:m})}),(0,o.jsx)(r.Jm,{tab:"stream-gears下载日志",itemKey:"download",children:(0,o.jsx)(d,{logs:l,logContainerRef:b,isLoading:m})}),(0,o.jsx)(r.Jm,{tab:"biliup-rs上传日志",itemKey:"upload",children:(0,o.jsx)(d,{logs:l,logContainerRef:b,isLoading:m})})]})})})]})}},70787:function(e,t,l){"use strict";var o=l(2265);let n=(0,l(87565).A)(function(e){return o.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),o.createElement("path",{d:"M6.08 8a6 6 0 0 1 11.84 0A1 1 0 0 0 17 9v7a1 1 0 0 0 1 1h.53a4.5 4.5 0 0 1-3.67 2.49A1 1 0 0 0 14 19h-4a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h4a1 1 0 0 0 .87-.51 6.5 6.5 0 0 0 5.84-4.58A3 3 0 0 0 23 14v-3a3 3 0 0 0-3-3h-.06A8 8 0 0 0 4.06 8H4a3 3 0 0 0-3 3v3a3 3 0 0 0 3 3h2a1 1 0 0 0 1-1V9a1 1 0 0 0-.92-1Z",fill:"currentColor"}))},"customer_support");t.Z=n}},function(e){e.O(0,[308,385,251,283,191,147,429,301,971,117,744],function(){return e(e.s=9435)}),_N_E=e.O()}]);