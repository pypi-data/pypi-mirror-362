# syntax=docker/dockerfile:1.3-labs
FROM debian:bookworm-slim

ENV container docker
ENV LC_ALL C
ENV DEBIAN_FRONTEND noninteractive

COPY ressources/tmp /tmp/ressources

#Â run install and cleanup
RUN bash /tmp/ressources/install_base.bash
RUN rm -rf {/tmp/deb,/tmp/ressources} && apt -y autoremove && apt clean

# Mock salt sdb
COPY ressources/usr/lib/python3/dist-packages/salt/modules/sdb.py /usr/lib/python3/dist-packages/salt/modules/sdb.py
COPY ressources/usr/lib/python3/dist-packages/salt/runners/sdb.py /usr/lib/python3/dist-packages/salt/runners/sdb.py

# Config saltstack
COPY ressources/etc/salt/master.d/override.conf /etc/salt/master.d/override.conf

# Start systemd
ENTRYPOINT ["/lib/systemd/systemd"]
