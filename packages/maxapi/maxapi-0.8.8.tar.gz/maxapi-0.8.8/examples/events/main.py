import asyncio
import logging

from maxapi import Bot, Dispatcher
from maxapi.types import (
    BotStarted, 
    Command, 
    MessageCreated, 
    CallbackButton, 
    MessageCallback, 
    BotAdded, 
    ChatTitleChanged, 
    MessageEdited, 
    MessageRemoved, 
    UserAdded, 
    UserRemoved
)
from maxapi.utils.inline_keyboard import InlineKeyboardBuilder

logging.basicConfig(level=logging.INFO)

bot = Bot('—Ç—É—Ç_–≤–∞—à_—Ç–æ–∫–µ–Ω')
dp = Dispatcher()


@dp.message_created(Command('start'))
async def hello(event: MessageCreated):
    builder = InlineKeyboardBuilder()

    builder.row(
        CallbackButton(
            text='–ö–Ω–æ–ø–∫–∞ 1',
            payload='btn_1'
        ),
        CallbackButton(
            text='–ö–Ω–æ–ø–∫–∞ 2',
            payload='btn_2',
        )
    )
    builder.add(
        CallbackButton(
            text='–ö–Ω–æ–ø–∫–∞ 3',
            payload='btn_3',
        )
    )

    await event.message.answer(
        text='–ü—Ä–∏–≤–µ—Ç!', 
        attachments=[
            builder.as_markup(),
        ]                               # –î–ª—è MAX –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —ç—Ç–æ –≤–ª–æ–∂–µ–Ω–∏–µ, 
    )                                       # –ø–æ—ç—Ç–æ–º—É –æ–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ –≤–ª–æ–∂–µ–Ω–∏–π


@dp.bot_added()
async def bot_added(event: BotAdded):
    await event.bot.send_message(
        chat_id=event.chat.id,
        text=f'–ü—Ä–∏–≤–µ—Ç —á–∞—Ç {event.chat.title}!'
    )
    
    
@dp.message_removed()
async def message_removed(event: MessageRemoved):
    await event.bot.send_message(
        chat_id=event.chat_id,
        text='–Ø –≤—Å—ë –≤–∏–¥–µ–ª!'
    )
    
    
@dp.bot_started()
async def bot_started(event: BotStarted):
    await event.bot.send_message(
        chat_id=event.chat_id,
        text='–ü—Ä–∏–≤–µ—Ç! –û—Ç–ø—Ä–∞–≤—å –º–Ω–µ /start'
    )
    
    
@dp.chat_title_changed()
async def chat_title_changed(event: ChatTitleChanged):
    await event.bot.send_message(
        chat_id=event.chat_id,
        text=f'–ö—Ä—É—Ç–æ–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ "{event.chat.title}!"'
    )
    
    
@dp.message_callback()
async def message_callback(event: MessageCallback):
    await event.answer(
        new_text=f'–í—ã –Ω–∞–∂–∞–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É {event.callback.payload}!'
    )
    

@dp.message_edited()
async def message_edited(event: MessageEdited):
    await event.message.answer(
        text='–í—ã –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ!'
    )
    
    
@dp.user_removed()
async def user_removed(event: UserRemoved):
    await event.bot.send_message(
        chat_id=event.chat_id,
        text=f'{event.from_user.first_name} –∫–∏–∫–Ω—É–ª {event.user.first_name} üò¢'
    )
    
    
@dp.user_added()
async def user_added(event: UserAdded):
    await event.bot.send_message(
        chat_id=event.chat_id,
        text=f'–ß–∞—Ç "{event.chat.title}" –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–∞—Å, {event.user.first_name}!'
    )


async def main():
    await dp.start_polling(bot)


if __name__ == '__main__':
    asyncio.run(main())